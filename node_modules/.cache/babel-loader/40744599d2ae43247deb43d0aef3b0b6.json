{"ast":null,"code":"'use strict';\n\nvar _slicedToArray = function () {\n  function sliceIterator(arr, i) {\n    var _arr = [];\n    var _n = true;\n    var _d = false;\n    var _e = undefined;\n\n    try {\n      for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n        _arr.push(_s.value);\n\n        if (i && _arr.length === i) break;\n      }\n    } catch (err) {\n      _d = true;\n      _e = err;\n    } finally {\n      try {\n        if (!_n && _i[\"return\"]) _i[\"return\"]();\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n\n    return _arr;\n  }\n\n  return function (arr, i) {\n    if (Array.isArray(arr)) {\n      return arr;\n    } else if (Symbol.iterator in Object(arr)) {\n      return sliceIterator(arr, i);\n    } else {\n      throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n    }\n  };\n}();\n\nvar _createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\nfunction _toConsumableArray(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  } else {\n    return Array.from(arr);\n  }\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n}\n\nvar EventEmitter = require('./eventemitter');\n\nvar RemoteParticipant = require('./remoteparticipant');\n\nvar StatsReport = require('./stats/statsreport');\n\nvar _require = require('./util'),\n    valueToJSON = _require.valueToJSON;\n\nvar nInstances = 0;\n/**\r\n * A {@link Room} represents communication between you and one or more\r\n * {@link RemoteParticipant}s sharing {@link AudioTrack}s and\r\n * {@link VideoTrack}s.\r\n * <br><br>\r\n * You can connect to a {@link Room} by calling {@link module:twilio-video.connect}.\r\n * @extends EventEmitter\r\n * @property {?RemoteParticipant} dominantSpeaker - The Dominant Speaker in the\r\n *   {@link Room}, if any\r\n * @property {boolean} isRecording - Whether or not the {@link Room} is being\r\n *   recorded\r\n * @property {LocalParticipant} localParticipant - Your {@link LocalParticipant}\r\n *   in the {@link Room}\r\n * @property {string} mediaRegion - String indicating geographical region\r\n *    where  media is processed for the {@link Room}.\r\n * @property {string} name - The {@link Room}'s name\r\n * @property {Map<Participant.SID, RemoteParticipant>} participants -\r\n *   The {@link RemoteParticipant}s participating in this {@link Room}\r\n * @property {Room.SID} sid - The {@link Room}'s SID\r\n * @property {string} state - \"connected\", \"reconnecting\", or \"disconnected\"\r\n * @throws {SignalingConnectionDisconnectedError}\r\n * @emits Room#disconnected\r\n * @emits Room#participantConnected\r\n * @emits Room#participantDisconnected\r\n * @emits Room#participantReconnected\r\n * @emits Room#participantReconnecting\r\n * @emits Room#reconnected\r\n * @emits Room#reconnecting\r\n * @emits Room#recordingStarted\r\n * @emits Room#recordingStopped\r\n * @emits Room#trackDimensionsChanged\r\n * @emits Room#trackDisabled\r\n * @emits Room#trackEnabled\r\n * @emits Room#trackMessage\r\n * @emits Room#trackPublished\r\n * @emits Room#trackPublishPriorityChanged\r\n * @emits Room#trackStarted\r\n * @emits Room#trackSubscribed\r\n * @emits Room#trackSwitchedOff\r\n * @emits Room#trackSwitchedOn\r\n * @emits Room#trackUnpublished\r\n * @emits Room#trackUnsubscribed\r\n */\n\nvar Room = function (_EventEmitter) {\n  _inherits(Room, _EventEmitter);\n  /**\r\n   * Construct a {@link Room}.\r\n   * @param {RoomSignaling} signaling\r\n   * @param {?object} [options={}]\r\n   */\n\n\n  function Room(localParticipant, signaling, options) {\n    _classCallCheck(this, Room);\n\n    var _this = _possibleConstructorReturn(this, (Room.__proto__ || Object.getPrototypeOf(Room)).call(this));\n\n    var log = options.log.createLog('default', _this);\n    var participants = new Map();\n    /* istanbul ignore next */\n\n    Object.defineProperties(_this, {\n      _log: {\n        value: log\n      },\n      _instanceId: {\n        value: ++nInstances\n      },\n      _options: {\n        value: options\n      },\n      _participants: {\n        value: participants\n      },\n      _signaling: {\n        value: signaling\n      },\n      dominantSpeaker: {\n        enumerable: true,\n        get: function get() {\n          return this.participants.get(signaling.dominantSpeakerSid) || null;\n        }\n      },\n      isRecording: {\n        enumerable: true,\n        get: function get() {\n          return signaling.recording.isEnabled || false;\n        }\n      },\n      localParticipant: {\n        enumerable: true,\n        value: localParticipant\n      },\n      name: {\n        enumerable: true,\n        value: signaling.name\n      },\n      participants: {\n        enumerable: true,\n        value: participants\n      },\n      sid: {\n        enumerable: true,\n        value: signaling.sid\n      },\n      state: {\n        enumerable: true,\n        get: function get() {\n          return signaling.state;\n        }\n      },\n      mediaRegion: {\n        enumerable: true,\n        value: signaling.mediaRegion\n      }\n    });\n    handleRecordingEvents(_this, signaling.recording);\n    handleSignalingEvents(_this, signaling);\n    log.info('Created a new Room:', _this.name);\n    log.debug('Initial RemoteParticipants:', Array.from(_this._participants.values()));\n    return _this;\n  }\n\n  _createClass(Room, [{\n    key: 'toString',\n    value: function toString() {\n      return '[Room #' + this._instanceId + ': ' + this.sid + ']';\n    }\n    /**\r\n     * Disconnect from the {@link Room}.\r\n     * @returns {this}\r\n     */\n\n  }, {\n    key: 'disconnect',\n    value: function disconnect() {\n      this._log.info('Disconnecting');\n\n      this._signaling.disconnect();\n\n      return this;\n    }\n    /**\r\n     * Get the {@link Room}'s media statistics. This is not supported in Safari 12.0 or below\r\n     * due to this bug : https://bugs.webkit.org/show_bug.cgi?id=192601\r\n     *\r\n     * @returns {Promise.<Array<StatsReport>>}\r\n     */\n\n  }, {\n    key: 'getStats',\n    value: function getStats() {\n      var _this2 = this;\n\n      return this._signaling.getStats().then(function (responses) {\n        return Array.from(responses).map(function (_ref) {\n          var _ref2 = _slicedToArray(_ref, 2),\n              id = _ref2[0],\n              response = _ref2[1];\n\n          return new StatsReport(id, Object.assign({}, response, {\n            localAudioTrackStats: rewriteLocalTrackIds(_this2, response.localAudioTrackStats),\n            localVideoTrackStats: rewriteLocalTrackIds(_this2, response.localVideoTrackStats)\n          }));\n        });\n      });\n    }\n  }, {\n    key: 'toJSON',\n    value: function toJSON() {\n      return valueToJSON(this);\n    }\n  }]);\n\n  return Room;\n}(EventEmitter);\n\nfunction rewriteLocalTrackIds(room, trackStats) {\n  var localParticipantSignaling = room.localParticipant._signaling;\n  return trackStats.reduce(function (trackStats, trackStat) {\n    var publication = localParticipantSignaling.tracks.get(trackStat.trackId);\n    var trackSender = localParticipantSignaling.getSender(publication);\n    return trackSender ? [Object.assign({}, trackStat, {\n      trackId: trackSender.id\n    })].concat(trackStats) : trackStats;\n  }, []);\n}\n/**\r\n * A {@link Room.SID} is a 34-character string starting with \"RM\"\r\n * that uniquely identifies a {@link Room}.\r\n * @type string\r\n * @typedef Room.SID\r\n */\n\n/**\r\n * The Dominant Speaker in the {@link Room} changed. Either the Dominant Speaker\r\n * is a new {@link RemoteParticipant} or the Dominant Speaker has been reset and\r\n * is now null.\r\n * @param {?RemoteParticipant} dominantSpeaker - The Dominant Speaker in the\r\n *   {@link Room}, if any\r\n * @event Room#dominantSpeakerChanged\r\n */\n\n/**\r\n * Your {@link LocalParticipant} was disconnected from the {@link Room} and all\r\n * other {@link RemoteParticipant}s.\r\n * @param {Room} room - The {@link Room} your\r\n *   {@link LocalParticipant} was disconnected from\r\n * @param {?TwilioError} error - Present when the {@link LocalParticipant} got\r\n *   disconnected from the {@link Room} unexpectedly\r\n * @event Room#disconnected\r\n * @example\r\n * myRoom.on('disconnected', function(room, error) {\r\n *   if (error) {\r\n *     console.log('Unexpectedly disconnected:', error);\r\n *   }\r\n *   myRoom.localParticipant.tracks.forEach(function(track) {\r\n *     track.stop();\r\n *     track.detach();\r\n *   });\r\n * });\r\n */\n\n/**\r\n * A {@link RemoteParticipant} joined the {@link Room}. In Large Group Rooms (Maximum\r\n * Participants greater than 50), this event is raised only when a {@link RemoteParticipant}\r\n * publishes at least one {@link LocalTrack}.\r\n * @param {RemoteParticipant} participant - The {@link RemoteParticipant} who joined\r\n * @event Room#participantConnected\r\n * @example\r\n * myRoom.on('participantConnected', function(participant) {\r\n *   console.log(participant.identity + ' joined the Room');\r\n * });\r\n */\n\n/**\r\n * A {@link RemoteParticipant} left the {@link Room}. In Large Group Rooms (Maximum\r\n * Participants greater than 50), this event is raised only when a {@link RemoteParticipant}\r\n * unpublishes all its {@link LocalTrack}s.\r\n * @param {RemoteParticipant} participant - The {@link RemoteParticipant} who left\r\n * @event Room#participantDisconnected\r\n * @example\r\n * myRoom.on('participantDisconnected', function(participant) {\r\n *   console.log(participant.identity + ' left the Room');\r\n *   participant.tracks.forEach(function(track) {\r\n *     track.detach().forEach(function(mediaElement) {\r\n *       mediaElement.remove();\r\n *     });\r\n *   });\r\n * });\r\n */\n\n/**\r\n * A {@link RemoteParticipant} has reconnected to the {@link Room} after a signaling connection disruption.\r\n * @param {RemoteParticipant} participant - The {@link RemoteParticipant} that has reconnected.\r\n * @event Room#participantReconnected\r\n * @example\r\n * myRoom.on('participantReconnected', participant => {\r\n *   console.log(participant.identity + ' reconnected to the Room');\r\n * });\r\n */\n\n/**\r\n * A {@link RemoteParticipant} is reconnecting to the {@link Room} after a signaling connection disruption.\r\n * @param {RemoteParticipant} participant - The {@link RemoteParticipant} that is reconnecting.\r\n * @event Room#participantReconnecting\r\n * @example\r\n * myRoom.on('participantReconnecting', participant => {\r\n *   console.log(participant.identity + ' is reconnecting to the Room');\r\n * });\r\n */\n\n/**\r\n * Your application successfully reconnected to the {@link Room}. When this\r\n * event is emitted, the {@link Room} is in state \"connected\".\r\n * @event Room#reconnected\r\n * @example\r\n * myRoom.on('reconnected', () => {\r\n *   console.log('Reconnected!');\r\n * });\r\n */\n\n/**\r\n * Your application is reconnecting to the {@link Room}. This happens when there\r\n * is a disruption in your signaling connection and/or your media connection. When\r\n * this event is emitted, the {@link Room} is in state \"reconnecting\". If reconnecting\r\n * succeeds, the {@link Room} will emit a \"reconnected\" event.\r\n * @param {MediaConnectionError|SignalingConnectionDisconnectedError} error - A\r\n *   {@link MediaConnectionError} if your application is reconnecting due to a\r\n *   disruption in your media connection, or a {@link SignalingConnectionDisconnectedError}\r\n *   if your application is reconnecting due to a disruption in your signaling connection\r\n * @event Room#reconnecting\r\n * @example\r\n * myRoom.on('reconnecting', error => {\r\n *   if (error.code === 53001) {\r\n *     console.log('Reconnecting your signaling connection!', error.message);\r\n *   } else if (error.code === 53405) {\r\n *     console.log('Reconnecting your media connection!', error.message);\r\n *   }\r\n * });\r\n */\n\n/**\r\n * The {@link Room} is now being recorded\r\n * @event Room#recordingStarted\r\n */\n\n/**\r\n * The {@link Room} is no longer being recorded\r\n * @event Room#recordingStopped\r\n */\n\n/**\r\n * One of the {@link RemoteParticipant}'s {@link VideoTrack}'s dimensions changed.\r\n * @param {RemoteVideoTrack} track - The {@link RemoteVideoTrack} whose dimensions changed\r\n * @param {RemoteParticipant} participant - The {@link RemoteParticipant} whose\r\n *   {@link RemoteVideoTrack}'s dimensions changed\r\n * @event Room#trackDimensionsChanged\r\n */\n\n/**\r\n * A {@link RemoteTrack} was disabled by a {@link RemoteParticipant} in the {@link Room}.\r\n * @param {RemoteTrackPublication} publication - The {@link RemoteTrackPublication} that represents disabled {@link RemoteTrack}\r\n * @param {RemoteParticipant} participant - The {@link RemoteParticipant} who\r\n *   disabled the {@link RemoteTrack}\r\n * @event Room#trackDisabled\r\n */\n\n/**\r\n * A {@link RemoteTrack} was enabled by a {@link RemoteParticipant} in the {@link Room}.\r\n * @param {RemoteTrackPublication} publication - The {@link RemoteTrackPublication} that represents enabled {@link RemoteTrack}\r\n * @param {RemoteParticipant} participant - The {@link RemoteParticipant} who\r\n *   enabled the {@link RemoteTrack}\r\n * @event Room#trackEnabled\r\n */\n\n/**\r\n * A message was received over one of the {@link RemoteParticipant}'s\r\n * {@link RemoteDataTrack}'s.\r\n * @param {string|ArrayBuffer} data\r\n * @param {RemoteDataTrack} track - The {@link RemoteDataTrack} over which the\r\n *   message was received\r\n * @param {RemoteParticipant} participant - The {@link RemoteParticipant} whose\r\n *   {@link RemoteDataTrack} received the message\r\n * @event Room#trackMessage\r\n */\n\n/**\r\n * A {@link RemoteTrack} was published by a {@link RemoteParticipant} after\r\n * connecting to the {@link Room}. This event is not emitted for\r\n * {@link RemoteTrack}s that were published while the {@link RemoteParticipant}\r\n * was connecting to the {@link Room}.\r\n * @event Room#trackPublished\r\n * @param {RemoteTrackPublication} publication - The {@link RemoteTrackPublication}\r\n *   which represents the published {@link RemoteTrack}\r\n * @param {RemoteParticipant} participant - The {@link RemoteParticipant} who\r\n *   published the {@link RemoteTrack}\r\n * @example\r\n * function trackPublished(publication, participant) {\r\n *   console.log(`RemoteParticipant ${participant.sid} published Track ${publication.trackSid}`);\r\n * }\r\n *\r\n * // Handle RemoteTracks published after connecting to the Room.\r\n * room.on('trackPublished', trackPublished);\r\n *\r\n * room.on('participantConnected', participant => {\r\n *   // Handle RemoteTracks published while connecting to the Room.\r\n *   participant.trackPublications.forEach(publication => trackPublished(publication, participant));\r\n * });\r\n */\n\n/**\r\n * One of a {@link RemoteParticipant}'s {@link RemoteTrack}s in the {@link Room} started.\r\n * @param {RemoteTrack} track - The {@link RemoteTrack} that started\r\n * @param {RemoteParticipant} participant - The {@link RemoteParticipant} whose\r\n *   {@link RemoteTrack} started\r\n * @event Room#trackStarted\r\n */\n\n/**\r\n * A {@link RemoteParticipant}'s {@link RemoteTrack} was subscribed to.\r\n * @param {RemoteTrack} track - The {@link RemoteTrack} that was subscribed\r\n * @param {RemoteTrackPublication} publication - The {@link RemoteTrackPublication}\r\n *   for the {@link RemoteTrack} that was subscribed to\r\n * @param {RemoteParticipant} participant - The {@link RemoteParticipant} whose\r\n *   {@link RemoteTrack} was subscribed\r\n * @event Room#trackSubscribed\r\n * @example\r\n * room.on('trackSubscribed', function(track, publication, participant) {\r\n *   var participantView = document.getElementById('participant-view-' + participant.identity);\r\n *   participantView.appendChild(track.attach());\r\n * });\r\n */\n\n/**\r\n * A {@link RemoteParticipant}'s {@link RemoteTrack} was switched off.\r\n * @param {RemoteTrack} track - The {@link RemoteTrack} that was switched off\r\n * @param {RemoteTrackPublication} publication - The {@link RemoteTrackPublication}\r\n *   for the {@link RemoteTrack} that was subscribed to\r\n * @param {RemoteParticipant} participant - The {@link RemoteParticipant} whose\r\n *   {@link RemoteTrack} was switched off\r\n * @event Room#trackSwitchedOff\r\n */\n\n/**\r\n * A {@link RemoteParticipant}'s {@link RemoteTrack} was switched on.\r\n * @param {RemoteTrack} track - The {@link RemoteTrack} that was switched on\r\n * @param {RemoteTrackPublication} publication - The {@link RemoteTrackPublication}\r\n *   for the {@link RemoteTrack} that was subscribed to\r\n * @param {RemoteParticipant} participant - The {@link RemoteParticipant} whose\r\n *   {@link RemoteTrack} was switched on\r\n * @event Room#trackSwitchedOn\r\n */\n\n/**\r\n * A {@link RemoteParticipant}'s {@link RemoteTrack} could not be subscribed to.\r\n * @param {TwilioError} error - The reason the {@link RemoteTrack} could not be\r\n *   subscribed to\r\n * @param {RemoteTrackPublication} publication - The\r\n *   {@link RemoteTrackPublication} for the {@link RemoteTrack} that could not\r\n *   be subscribed to\r\n * @param {RemoteParticipant} participant - The {@link RemoteParticipant} whose\r\n *   {@link RemoteTrack} could not be subscribed to\r\n * @event Room#trackSubscriptionFailed\r\n */\n\n/**\r\n * The {@link RemoteTrack}'s publish {@link Track.Priority} was changed by the\r\n * {@link RemoteParticipant}.\r\n * @param {Track.Priority} priority - the {@link RemoteTrack}'s new publish\r\n *   {@link Track.Priority};\r\n * @param {RemoteTrackPublication} publication - The\r\n *   {@link RemoteTrackPublication} for the {@link RemoteTrack} that changed priority\r\n * @param {RemoteParticipant} participant - The {@link RemoteParticipant} whose\r\n *   {@link RemoteTrack} changed priority\r\n * @event Room#trackPublishPriorityChanged\r\n */\n\n/**\r\n * A {@link RemoteTrack} was unpublished by a {@link RemoteParticipant} to the {@link Room}.\r\n * @event Room#trackUnpublished\r\n * @param {RemoteTrackPublication} publication - The {@link RemoteTrackPublication}\r\n *   which represents the unpublished {@link RemoteTrack}\r\n * @param {RemoteParticipant} participant - The {@link RemoteParticipant} who\r\n *   unpublished the {@link RemoteTrack}\r\n */\n\n/**\r\n * A {@link RemoteParticipant}'s {@link RemoteTrack} was unsubscribed from.\r\n * @param {RemoteTrack} track - The {@link RemoteTrack} that was unsubscribed\r\n * @param {RemoteTrackPublication} publication - The {@link RemoteTrackPublication}\r\n *   for the {@link RemoteTrack} that was unsubscribed from\r\n * @param {RemoteParticipant} participant - The {@link RemoteParticipant} whose\r\n *   {@link RemoteTrack} was unsubscribed\r\n * @event Room#trackUnsubscribed\r\n * @example\r\n * room.on('trackUnsubscribed', function(track, publication, participant) {\r\n *   track.detach().forEach(function(mediaElement) {\r\n *     mediaElement.remove();\r\n *   });\r\n * });\r\n */\n\n\nfunction connectParticipant(room, participantSignaling) {\n  var log = room._log;\n  var participant = new RemoteParticipant(participantSignaling, {\n    log: log\n  });\n  log.info('A new RemoteParticipant connected:', participant);\n\n  room._participants.set(participant.sid, participant);\n\n  room.emit('participantConnected', participant); // Reemit Track and RemoteParticipant events.\n\n  var eventListeners = [['reconnected', 'participantReconnected'], ['reconnecting', 'participantReconnecting'], 'trackDimensionsChanged', 'trackDisabled', 'trackEnabled', 'trackMessage', 'trackPublished', 'trackPublishPriorityChanged', 'trackStarted', 'trackSubscribed', 'trackSubscriptionFailed', 'trackSwitchedOff', 'trackSwitchedOn', 'trackUnpublished', 'trackUnsubscribed'].map(function (eventOrPair) {\n    var _ref3 = Array.isArray(eventOrPair) ? eventOrPair : [eventOrPair, eventOrPair],\n        _ref4 = _slicedToArray(_ref3, 2),\n        event = _ref4[0],\n        participantEvent = _ref4[1];\n\n    function reemit() {\n      var args = [].slice.call(arguments);\n      args.unshift(participantEvent);\n      args.push(participant);\n      room.emit.apply(room, _toConsumableArray(args));\n    }\n\n    participant.on(event, reemit);\n    return [event, reemit];\n  });\n  participant.once('disconnected', function participantDisconnected() {\n    var dominantSpeaker = room.dominantSpeaker;\n    log.info('RemoteParticipant disconnected:', participant);\n\n    room._participants.delete(participant.sid);\n\n    eventListeners.forEach(function (args) {\n      participant.removeListener(args[0], args[1]);\n    });\n    room.emit('participantDisconnected', participant);\n\n    if (participant === dominantSpeaker) {\n      room.emit('dominantSpeakerChanged', room.dominantSpeaker);\n    }\n  });\n}\n\nfunction handleRecordingEvents(room, recording) {\n  recording.on('updated', function updated() {\n    var started = recording.isEnabled;\n\n    room._log.info('Recording ' + (started ? 'started' : 'stopped'));\n\n    room.emit('recording' + (started ? 'Started' : 'Stopped'));\n  });\n}\n\nfunction handleSignalingEvents(room, signaling) {\n  var log = room._log; // Reemit RemoteParticipant events from the RoomSignaling.\n\n  log.debug('Creating a new RemoteParticipant for each ParticipantSignaling ' + 'in the RoomSignaling');\n  signaling.participants.forEach(connectParticipant.bind(null, room));\n  log.debug('Setting up RemoteParticipant creation for all subsequent ' + 'ParticipantSignalings that connect to the RoomSignaling');\n  signaling.on('participantConnected', connectParticipant.bind(null, room));\n  signaling.on('dominantSpeakerChanged', function () {\n    return room.emit('dominantSpeakerChanged', room.dominantSpeaker);\n  }); // Reemit state transition events from the RoomSignaling.\n\n  signaling.on('stateChanged', function stateChanged(state, error) {\n    log.info('Transitioned to state:', state);\n\n    switch (state) {\n      case 'disconnected':\n        room.participants.forEach(function (participant) {\n          participant._unsubscribeTracks();\n        });\n        room.emit(state, room, error);\n        room.localParticipant.tracks.forEach(function (publication) {\n          publication.unpublish();\n        });\n        signaling.removeListener('stateChanged', stateChanged);\n        break;\n\n      case 'reconnecting':\n        // NOTE(mpatwardhan): `stateChanged` can get emitted with StateMachine locked.\n        // Do not signal  public events synchronously with lock held.\n        setTimeout(function () {\n          return room.emit('reconnecting', error);\n        }, 0);\n        break;\n\n      default:\n        // NOTE(mpatwardhan): `stateChanged` can get emitted with StateMachine locked.\n        // Do not signal  public events synchronously with lock held.\n        setTimeout(function () {\n          return room.emit('reconnected');\n        }, 0);\n    }\n  });\n}\n\nmodule.exports = Room;","map":{"version":3,"sources":["C:/Users/USER/Desktop/ARSW III/Twilio/node_modules/twilio-video/es5/room.js"],"names":["_slicedToArray","sliceIterator","arr","i","_arr","_n","_d","_e","undefined","_i","Symbol","iterator","_s","next","done","push","value","length","err","Array","isArray","Object","TypeError","_createClass","defineProperties","target","props","descriptor","enumerable","configurable","writable","defineProperty","key","Constructor","protoProps","staticProps","prototype","_toConsumableArray","arr2","from","_classCallCheck","instance","_possibleConstructorReturn","self","call","ReferenceError","_inherits","subClass","superClass","create","constructor","setPrototypeOf","__proto__","EventEmitter","require","RemoteParticipant","StatsReport","_require","valueToJSON","nInstances","Room","_EventEmitter","localParticipant","signaling","options","_this","getPrototypeOf","log","createLog","participants","Map","_log","_instanceId","_options","_participants","_signaling","dominantSpeaker","get","dominantSpeakerSid","isRecording","recording","isEnabled","name","sid","state","mediaRegion","handleRecordingEvents","handleSignalingEvents","info","debug","values","toString","disconnect","getStats","_this2","then","responses","map","_ref","_ref2","id","response","assign","localAudioTrackStats","rewriteLocalTrackIds","localVideoTrackStats","toJSON","room","trackStats","localParticipantSignaling","reduce","trackStat","publication","tracks","trackId","trackSender","getSender","concat","connectParticipant","participantSignaling","participant","set","emit","eventListeners","eventOrPair","_ref3","_ref4","event","participantEvent","reemit","args","slice","arguments","unshift","apply","on","once","participantDisconnected","delete","forEach","removeListener","updated","started","bind","stateChanged","error","_unsubscribeTracks","unpublish","setTimeout","module","exports"],"mappings":"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GAAGH,yBAAyB,CAACI,MAA1B,CAAiCpC,GAAjC,CAAqCkC,SAAS,CAACG,OAA/C,CAAlB;AACA,QAAIC,WAAW,GAAGN,yBAAyB,CAACO,SAA1B,CAAoCJ,WAApC,CAAlB;AACA,WAAOG,WAAW,GAAG,CAAC9F,MAAM,CAACiF,MAAP,CAAc,EAAd,EAAkBS,SAAlB,EAA6B;AAAEG,MAAAA,OAAO,EAAEC,WAAW,CAACf;AAAvB,KAA7B,CAAD,EAA4DiB,MAA5D,CAAmET,UAAnE,CAAH,GAAoFA,UAAtG;AACD,GAJM,EAIJ,EAJI,CAAP;AAKD;AAED;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA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","sourcesContent":["'use strict';\r\n\r\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\r\n\r\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\r\n\r\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\r\n\r\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\r\n\r\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\r\n\r\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\r\n\r\nvar EventEmitter = require('./eventemitter');\r\nvar RemoteParticipant = require('./remoteparticipant');\r\nvar StatsReport = require('./stats/statsreport');\r\n\r\nvar _require = require('./util'),\r\n    valueToJSON = _require.valueToJSON;\r\n\r\nvar nInstances = 0;\r\n\r\n/**\r\n * A {@link Room} represents communication between you and one or more\r\n * {@link RemoteParticipant}s sharing {@link AudioTrack}s and\r\n * {@link VideoTrack}s.\r\n * <br><br>\r\n * You can connect to a {@link Room} by calling {@link module:twilio-video.connect}.\r\n * @extends EventEmitter\r\n * @property {?RemoteParticipant} dominantSpeaker - The Dominant Speaker in the\r\n *   {@link Room}, if any\r\n * @property {boolean} isRecording - Whether or not the {@link Room} is being\r\n *   recorded\r\n * @property {LocalParticipant} localParticipant - Your {@link LocalParticipant}\r\n *   in the {@link Room}\r\n * @property {string} mediaRegion - String indicating geographical region\r\n *    where  media is processed for the {@link Room}.\r\n * @property {string} name - The {@link Room}'s name\r\n * @property {Map<Participant.SID, RemoteParticipant>} participants -\r\n *   The {@link RemoteParticipant}s participating in this {@link Room}\r\n * @property {Room.SID} sid - The {@link Room}'s SID\r\n * @property {string} state - \"connected\", \"reconnecting\", or \"disconnected\"\r\n * @throws {SignalingConnectionDisconnectedError}\r\n * @emits Room#disconnected\r\n * @emits Room#participantConnected\r\n * @emits Room#participantDisconnected\r\n * @emits Room#participantReconnected\r\n * @emits Room#participantReconnecting\r\n * @emits Room#reconnected\r\n * @emits Room#reconnecting\r\n * @emits Room#recordingStarted\r\n * @emits Room#recordingStopped\r\n * @emits Room#trackDimensionsChanged\r\n * @emits Room#trackDisabled\r\n * @emits Room#trackEnabled\r\n * @emits Room#trackMessage\r\n * @emits Room#trackPublished\r\n * @emits Room#trackPublishPriorityChanged\r\n * @emits Room#trackStarted\r\n * @emits Room#trackSubscribed\r\n * @emits Room#trackSwitchedOff\r\n * @emits Room#trackSwitchedOn\r\n * @emits Room#trackUnpublished\r\n * @emits Room#trackUnsubscribed\r\n */\r\n\r\nvar Room = function (_EventEmitter) {\r\n  _inherits(Room, _EventEmitter);\r\n\r\n  /**\r\n   * Construct a {@link Room}.\r\n   * @param {RoomSignaling} signaling\r\n   * @param {?object} [options={}]\r\n   */\r\n  function Room(localParticipant, signaling, options) {\r\n    _classCallCheck(this, Room);\r\n\r\n    var _this = _possibleConstructorReturn(this, (Room.__proto__ || Object.getPrototypeOf(Room)).call(this));\r\n\r\n    var log = options.log.createLog('default', _this);\r\n    var participants = new Map();\r\n\r\n    /* istanbul ignore next */\r\n    Object.defineProperties(_this, {\r\n      _log: {\r\n        value: log\r\n      },\r\n      _instanceId: {\r\n        value: ++nInstances\r\n      },\r\n      _options: {\r\n        value: options\r\n      },\r\n      _participants: {\r\n        value: participants\r\n      },\r\n      _signaling: {\r\n        value: signaling\r\n      },\r\n      dominantSpeaker: {\r\n        enumerable: true,\r\n        get: function get() {\r\n          return this.participants.get(signaling.dominantSpeakerSid) || null;\r\n        }\r\n      },\r\n      isRecording: {\r\n        enumerable: true,\r\n        get: function get() {\r\n          return signaling.recording.isEnabled || false;\r\n        }\r\n      },\r\n      localParticipant: {\r\n        enumerable: true,\r\n        value: localParticipant\r\n      },\r\n      name: {\r\n        enumerable: true,\r\n        value: signaling.name\r\n      },\r\n      participants: {\r\n        enumerable: true,\r\n        value: participants\r\n      },\r\n      sid: {\r\n        enumerable: true,\r\n        value: signaling.sid\r\n      },\r\n      state: {\r\n        enumerable: true,\r\n        get: function get() {\r\n          return signaling.state;\r\n        }\r\n      },\r\n      mediaRegion: {\r\n        enumerable: true,\r\n        value: signaling.mediaRegion\r\n      }\r\n    });\r\n\r\n    handleRecordingEvents(_this, signaling.recording);\r\n    handleSignalingEvents(_this, signaling);\r\n\r\n    log.info('Created a new Room:', _this.name);\r\n    log.debug('Initial RemoteParticipants:', Array.from(_this._participants.values()));\r\n    return _this;\r\n  }\r\n\r\n  _createClass(Room, [{\r\n    key: 'toString',\r\n    value: function toString() {\r\n      return '[Room #' + this._instanceId + ': ' + this.sid + ']';\r\n    }\r\n\r\n    /**\r\n     * Disconnect from the {@link Room}.\r\n     * @returns {this}\r\n     */\r\n\r\n  }, {\r\n    key: 'disconnect',\r\n    value: function disconnect() {\r\n      this._log.info('Disconnecting');\r\n      this._signaling.disconnect();\r\n      return this;\r\n    }\r\n\r\n    /**\r\n     * Get the {@link Room}'s media statistics. This is not supported in Safari 12.0 or below\r\n     * due to this bug : https://bugs.webkit.org/show_bug.cgi?id=192601\r\n     *\r\n     * @returns {Promise.<Array<StatsReport>>}\r\n     */\r\n\r\n  }, {\r\n    key: 'getStats',\r\n    value: function getStats() {\r\n      var _this2 = this;\r\n\r\n      return this._signaling.getStats().then(function (responses) {\r\n        return Array.from(responses).map(function (_ref) {\r\n          var _ref2 = _slicedToArray(_ref, 2),\r\n              id = _ref2[0],\r\n              response = _ref2[1];\r\n\r\n          return new StatsReport(id, Object.assign({}, response, {\r\n            localAudioTrackStats: rewriteLocalTrackIds(_this2, response.localAudioTrackStats),\r\n            localVideoTrackStats: rewriteLocalTrackIds(_this2, response.localVideoTrackStats)\r\n          }));\r\n        });\r\n      });\r\n    }\r\n  }, {\r\n    key: 'toJSON',\r\n    value: function toJSON() {\r\n      return valueToJSON(this);\r\n    }\r\n  }]);\r\n\r\n  return Room;\r\n}(EventEmitter);\r\n\r\nfunction rewriteLocalTrackIds(room, trackStats) {\r\n  var localParticipantSignaling = room.localParticipant._signaling;\r\n  return trackStats.reduce(function (trackStats, trackStat) {\r\n    var publication = localParticipantSignaling.tracks.get(trackStat.trackId);\r\n    var trackSender = localParticipantSignaling.getSender(publication);\r\n    return trackSender ? [Object.assign({}, trackStat, { trackId: trackSender.id })].concat(trackStats) : trackStats;\r\n  }, []);\r\n}\r\n\r\n/**\r\n * A {@link Room.SID} is a 34-character string starting with \"RM\"\r\n * that uniquely identifies a {@link Room}.\r\n * @type string\r\n * @typedef Room.SID\r\n */\r\n\r\n/**\r\n * The Dominant Speaker in the {@link Room} changed. Either the Dominant Speaker\r\n * is a new {@link RemoteParticipant} or the Dominant Speaker has been reset and\r\n * is now null.\r\n * @param {?RemoteParticipant} dominantSpeaker - The Dominant Speaker in the\r\n *   {@link Room}, if any\r\n * @event Room#dominantSpeakerChanged\r\n */\r\n\r\n/**\r\n * Your {@link LocalParticipant} was disconnected from the {@link Room} and all\r\n * other {@link RemoteParticipant}s.\r\n * @param {Room} room - The {@link Room} your\r\n *   {@link LocalParticipant} was disconnected from\r\n * @param {?TwilioError} error - Present when the {@link LocalParticipant} got\r\n *   disconnected from the {@link Room} unexpectedly\r\n * @event Room#disconnected\r\n * @example\r\n * myRoom.on('disconnected', function(room, error) {\r\n *   if (error) {\r\n *     console.log('Unexpectedly disconnected:', error);\r\n *   }\r\n *   myRoom.localParticipant.tracks.forEach(function(track) {\r\n *     track.stop();\r\n *     track.detach();\r\n *   });\r\n * });\r\n */\r\n\r\n/**\r\n * A {@link RemoteParticipant} joined the {@link Room}. In Large Group Rooms (Maximum\r\n * Participants greater than 50), this event is raised only when a {@link RemoteParticipant}\r\n * publishes at least one {@link LocalTrack}.\r\n * @param {RemoteParticipant} participant - The {@link RemoteParticipant} who joined\r\n * @event Room#participantConnected\r\n * @example\r\n * myRoom.on('participantConnected', function(participant) {\r\n *   console.log(participant.identity + ' joined the Room');\r\n * });\r\n */\r\n\r\n/**\r\n * A {@link RemoteParticipant} left the {@link Room}. In Large Group Rooms (Maximum\r\n * Participants greater than 50), this event is raised only when a {@link RemoteParticipant}\r\n * unpublishes all its {@link LocalTrack}s.\r\n * @param {RemoteParticipant} participant - The {@link RemoteParticipant} who left\r\n * @event Room#participantDisconnected\r\n * @example\r\n * myRoom.on('participantDisconnected', function(participant) {\r\n *   console.log(participant.identity + ' left the Room');\r\n *   participant.tracks.forEach(function(track) {\r\n *     track.detach().forEach(function(mediaElement) {\r\n *       mediaElement.remove();\r\n *     });\r\n *   });\r\n * });\r\n */\r\n\r\n/**\r\n * A {@link RemoteParticipant} has reconnected to the {@link Room} after a signaling connection disruption.\r\n * @param {RemoteParticipant} participant - The {@link RemoteParticipant} that has reconnected.\r\n * @event Room#participantReconnected\r\n * @example\r\n * myRoom.on('participantReconnected', participant => {\r\n *   console.log(participant.identity + ' reconnected to the Room');\r\n * });\r\n */\r\n\r\n/**\r\n * A {@link RemoteParticipant} is reconnecting to the {@link Room} after a signaling connection disruption.\r\n * @param {RemoteParticipant} participant - The {@link RemoteParticipant} that is reconnecting.\r\n * @event Room#participantReconnecting\r\n * @example\r\n * myRoom.on('participantReconnecting', participant => {\r\n *   console.log(participant.identity + ' is reconnecting to the Room');\r\n * });\r\n */\r\n\r\n/**\r\n * Your application successfully reconnected to the {@link Room}. When this\r\n * event is emitted, the {@link Room} is in state \"connected\".\r\n * @event Room#reconnected\r\n * @example\r\n * myRoom.on('reconnected', () => {\r\n *   console.log('Reconnected!');\r\n * });\r\n */\r\n\r\n/**\r\n * Your application is reconnecting to the {@link Room}. This happens when there\r\n * is a disruption in your signaling connection and/or your media connection. When\r\n * this event is emitted, the {@link Room} is in state \"reconnecting\". If reconnecting\r\n * succeeds, the {@link Room} will emit a \"reconnected\" event.\r\n * @param {MediaConnectionError|SignalingConnectionDisconnectedError} error - A\r\n *   {@link MediaConnectionError} if your application is reconnecting due to a\r\n *   disruption in your media connection, or a {@link SignalingConnectionDisconnectedError}\r\n *   if your application is reconnecting due to a disruption in your signaling connection\r\n * @event Room#reconnecting\r\n * @example\r\n * myRoom.on('reconnecting', error => {\r\n *   if (error.code === 53001) {\r\n *     console.log('Reconnecting your signaling connection!', error.message);\r\n *   } else if (error.code === 53405) {\r\n *     console.log('Reconnecting your media connection!', error.message);\r\n *   }\r\n * });\r\n */\r\n\r\n/**\r\n * The {@link Room} is now being recorded\r\n * @event Room#recordingStarted\r\n */\r\n\r\n/**\r\n * The {@link Room} is no longer being recorded\r\n * @event Room#recordingStopped\r\n */\r\n\r\n/**\r\n * One of the {@link RemoteParticipant}'s {@link VideoTrack}'s dimensions changed.\r\n * @param {RemoteVideoTrack} track - The {@link RemoteVideoTrack} whose dimensions changed\r\n * @param {RemoteParticipant} participant - The {@link RemoteParticipant} whose\r\n *   {@link RemoteVideoTrack}'s dimensions changed\r\n * @event Room#trackDimensionsChanged\r\n */\r\n\r\n/**\r\n * A {@link RemoteTrack} was disabled by a {@link RemoteParticipant} in the {@link Room}.\r\n * @param {RemoteTrackPublication} publication - The {@link RemoteTrackPublication} that represents disabled {@link RemoteTrack}\r\n * @param {RemoteParticipant} participant - The {@link RemoteParticipant} who\r\n *   disabled the {@link RemoteTrack}\r\n * @event Room#trackDisabled\r\n */\r\n\r\n/**\r\n * A {@link RemoteTrack} was enabled by a {@link RemoteParticipant} in the {@link Room}.\r\n * @param {RemoteTrackPublication} publication - The {@link RemoteTrackPublication} that represents enabled {@link RemoteTrack}\r\n * @param {RemoteParticipant} participant - The {@link RemoteParticipant} who\r\n *   enabled the {@link RemoteTrack}\r\n * @event Room#trackEnabled\r\n */\r\n\r\n/**\r\n * A message was received over one of the {@link RemoteParticipant}'s\r\n * {@link RemoteDataTrack}'s.\r\n * @param {string|ArrayBuffer} data\r\n * @param {RemoteDataTrack} track - The {@link RemoteDataTrack} over which the\r\n *   message was received\r\n * @param {RemoteParticipant} participant - The {@link RemoteParticipant} whose\r\n *   {@link RemoteDataTrack} received the message\r\n * @event Room#trackMessage\r\n */\r\n\r\n/**\r\n * A {@link RemoteTrack} was published by a {@link RemoteParticipant} after\r\n * connecting to the {@link Room}. This event is not emitted for\r\n * {@link RemoteTrack}s that were published while the {@link RemoteParticipant}\r\n * was connecting to the {@link Room}.\r\n * @event Room#trackPublished\r\n * @param {RemoteTrackPublication} publication - The {@link RemoteTrackPublication}\r\n *   which represents the published {@link RemoteTrack}\r\n * @param {RemoteParticipant} participant - The {@link RemoteParticipant} who\r\n *   published the {@link RemoteTrack}\r\n * @example\r\n * function trackPublished(publication, participant) {\r\n *   console.log(`RemoteParticipant ${participant.sid} published Track ${publication.trackSid}`);\r\n * }\r\n *\r\n * // Handle RemoteTracks published after connecting to the Room.\r\n * room.on('trackPublished', trackPublished);\r\n *\r\n * room.on('participantConnected', participant => {\r\n *   // Handle RemoteTracks published while connecting to the Room.\r\n *   participant.trackPublications.forEach(publication => trackPublished(publication, participant));\r\n * });\r\n */\r\n\r\n/**\r\n * One of a {@link RemoteParticipant}'s {@link RemoteTrack}s in the {@link Room} started.\r\n * @param {RemoteTrack} track - The {@link RemoteTrack} that started\r\n * @param {RemoteParticipant} participant - The {@link RemoteParticipant} whose\r\n *   {@link RemoteTrack} started\r\n * @event Room#trackStarted\r\n */\r\n\r\n/**\r\n * A {@link RemoteParticipant}'s {@link RemoteTrack} was subscribed to.\r\n * @param {RemoteTrack} track - The {@link RemoteTrack} that was subscribed\r\n * @param {RemoteTrackPublication} publication - The {@link RemoteTrackPublication}\r\n *   for the {@link RemoteTrack} that was subscribed to\r\n * @param {RemoteParticipant} participant - The {@link RemoteParticipant} whose\r\n *   {@link RemoteTrack} was subscribed\r\n * @event Room#trackSubscribed\r\n * @example\r\n * room.on('trackSubscribed', function(track, publication, participant) {\r\n *   var participantView = document.getElementById('participant-view-' + participant.identity);\r\n *   participantView.appendChild(track.attach());\r\n * });\r\n */\r\n\r\n/**\r\n * A {@link RemoteParticipant}'s {@link RemoteTrack} was switched off.\r\n * @param {RemoteTrack} track - The {@link RemoteTrack} that was switched off\r\n * @param {RemoteTrackPublication} publication - The {@link RemoteTrackPublication}\r\n *   for the {@link RemoteTrack} that was subscribed to\r\n * @param {RemoteParticipant} participant - The {@link RemoteParticipant} whose\r\n *   {@link RemoteTrack} was switched off\r\n * @event Room#trackSwitchedOff\r\n */\r\n\r\n/**\r\n * A {@link RemoteParticipant}'s {@link RemoteTrack} was switched on.\r\n * @param {RemoteTrack} track - The {@link RemoteTrack} that was switched on\r\n * @param {RemoteTrackPublication} publication - The {@link RemoteTrackPublication}\r\n *   for the {@link RemoteTrack} that was subscribed to\r\n * @param {RemoteParticipant} participant - The {@link RemoteParticipant} whose\r\n *   {@link RemoteTrack} was switched on\r\n * @event Room#trackSwitchedOn\r\n */\r\n\r\n/**\r\n * A {@link RemoteParticipant}'s {@link RemoteTrack} could not be subscribed to.\r\n * @param {TwilioError} error - The reason the {@link RemoteTrack} could not be\r\n *   subscribed to\r\n * @param {RemoteTrackPublication} publication - The\r\n *   {@link RemoteTrackPublication} for the {@link RemoteTrack} that could not\r\n *   be subscribed to\r\n * @param {RemoteParticipant} participant - The {@link RemoteParticipant} whose\r\n *   {@link RemoteTrack} could not be subscribed to\r\n * @event Room#trackSubscriptionFailed\r\n */\r\n\r\n/**\r\n * The {@link RemoteTrack}'s publish {@link Track.Priority} was changed by the\r\n * {@link RemoteParticipant}.\r\n * @param {Track.Priority} priority - the {@link RemoteTrack}'s new publish\r\n *   {@link Track.Priority};\r\n * @param {RemoteTrackPublication} publication - The\r\n *   {@link RemoteTrackPublication} for the {@link RemoteTrack} that changed priority\r\n * @param {RemoteParticipant} participant - The {@link RemoteParticipant} whose\r\n *   {@link RemoteTrack} changed priority\r\n * @event Room#trackPublishPriorityChanged\r\n */\r\n\r\n/**\r\n * A {@link RemoteTrack} was unpublished by a {@link RemoteParticipant} to the {@link Room}.\r\n * @event Room#trackUnpublished\r\n * @param {RemoteTrackPublication} publication - The {@link RemoteTrackPublication}\r\n *   which represents the unpublished {@link RemoteTrack}\r\n * @param {RemoteParticipant} participant - The {@link RemoteParticipant} who\r\n *   unpublished the {@link RemoteTrack}\r\n */\r\n\r\n/**\r\n * A {@link RemoteParticipant}'s {@link RemoteTrack} was unsubscribed from.\r\n * @param {RemoteTrack} track - The {@link RemoteTrack} that was unsubscribed\r\n * @param {RemoteTrackPublication} publication - The {@link RemoteTrackPublication}\r\n *   for the {@link RemoteTrack} that was unsubscribed from\r\n * @param {RemoteParticipant} participant - The {@link RemoteParticipant} whose\r\n *   {@link RemoteTrack} was unsubscribed\r\n * @event Room#trackUnsubscribed\r\n * @example\r\n * room.on('trackUnsubscribed', function(track, publication, participant) {\r\n *   track.detach().forEach(function(mediaElement) {\r\n *     mediaElement.remove();\r\n *   });\r\n * });\r\n */\r\n\r\nfunction connectParticipant(room, participantSignaling) {\r\n  var log = room._log;\r\n  var participant = new RemoteParticipant(participantSignaling, { log: log });\r\n\r\n  log.info('A new RemoteParticipant connected:', participant);\r\n  room._participants.set(participant.sid, participant);\r\n  room.emit('participantConnected', participant);\r\n\r\n  // Reemit Track and RemoteParticipant events.\r\n  var eventListeners = [['reconnected', 'participantReconnected'], ['reconnecting', 'participantReconnecting'], 'trackDimensionsChanged', 'trackDisabled', 'trackEnabled', 'trackMessage', 'trackPublished', 'trackPublishPriorityChanged', 'trackStarted', 'trackSubscribed', 'trackSubscriptionFailed', 'trackSwitchedOff', 'trackSwitchedOn', 'trackUnpublished', 'trackUnsubscribed'].map(function (eventOrPair) {\r\n    var _ref3 = Array.isArray(eventOrPair) ? eventOrPair : [eventOrPair, eventOrPair],\r\n        _ref4 = _slicedToArray(_ref3, 2),\r\n        event = _ref4[0],\r\n        participantEvent = _ref4[1];\r\n\r\n    function reemit() {\r\n      var args = [].slice.call(arguments);\r\n      args.unshift(participantEvent);\r\n      args.push(participant);\r\n      room.emit.apply(room, _toConsumableArray(args));\r\n    }\r\n    participant.on(event, reemit);\r\n    return [event, reemit];\r\n  });\r\n\r\n  participant.once('disconnected', function participantDisconnected() {\r\n    var dominantSpeaker = room.dominantSpeaker;\r\n    log.info('RemoteParticipant disconnected:', participant);\r\n    room._participants.delete(participant.sid);\r\n    eventListeners.forEach(function (args) {\r\n      participant.removeListener(args[0], args[1]);\r\n    });\r\n    room.emit('participantDisconnected', participant);\r\n    if (participant === dominantSpeaker) {\r\n      room.emit('dominantSpeakerChanged', room.dominantSpeaker);\r\n    }\r\n  });\r\n}\r\n\r\nfunction handleRecordingEvents(room, recording) {\r\n  recording.on('updated', function updated() {\r\n    var started = recording.isEnabled;\r\n    room._log.info('Recording ' + (started ? 'started' : 'stopped'));\r\n    room.emit('recording' + (started ? 'Started' : 'Stopped'));\r\n  });\r\n}\r\n\r\nfunction handleSignalingEvents(room, signaling) {\r\n  var log = room._log;\r\n\r\n  // Reemit RemoteParticipant events from the RoomSignaling.\r\n  log.debug('Creating a new RemoteParticipant for each ParticipantSignaling ' + 'in the RoomSignaling');\r\n  signaling.participants.forEach(connectParticipant.bind(null, room));\r\n  log.debug('Setting up RemoteParticipant creation for all subsequent ' + 'ParticipantSignalings that connect to the RoomSignaling');\r\n  signaling.on('participantConnected', connectParticipant.bind(null, room));\r\n\r\n  signaling.on('dominantSpeakerChanged', function () {\r\n    return room.emit('dominantSpeakerChanged', room.dominantSpeaker);\r\n  });\r\n\r\n  // Reemit state transition events from the RoomSignaling.\r\n  signaling.on('stateChanged', function stateChanged(state, error) {\r\n    log.info('Transitioned to state:', state);\r\n    switch (state) {\r\n      case 'disconnected':\r\n        room.participants.forEach(function (participant) {\r\n          participant._unsubscribeTracks();\r\n        });\r\n        room.emit(state, room, error);\r\n        room.localParticipant.tracks.forEach(function (publication) {\r\n          publication.unpublish();\r\n        });\r\n        signaling.removeListener('stateChanged', stateChanged);\r\n        break;\r\n      case 'reconnecting':\r\n\r\n        // NOTE(mpatwardhan): `stateChanged` can get emitted with StateMachine locked.\r\n        // Do not signal  public events synchronously with lock held.\r\n        setTimeout(function () {\r\n          return room.emit('reconnecting', error);\r\n        }, 0);\r\n\r\n        break;\r\n      default:\r\n\r\n        // NOTE(mpatwardhan): `stateChanged` can get emitted with StateMachine locked.\r\n        // Do not signal  public events synchronously with lock held.\r\n        setTimeout(function () {\r\n          return room.emit('reconnected');\r\n        }, 0);\r\n    }\r\n  });\r\n}\r\n\r\nmodule.exports = Room;"]},"metadata":{},"sourceType":"script"}