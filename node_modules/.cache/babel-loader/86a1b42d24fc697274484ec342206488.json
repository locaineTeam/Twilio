{"ast":null,"code":"'use strict';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) {\n  return typeof obj;\n} : function (obj) {\n  return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n};\n\nvar _slicedToArray = function () {\n  function sliceIterator(arr, i) {\n    var _arr = [];\n    var _n = true;\n    var _d = false;\n    var _e = undefined;\n\n    try {\n      for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n        _arr.push(_s.value);\n\n        if (i && _arr.length === i) break;\n      }\n    } catch (err) {\n      _d = true;\n      _e = err;\n    } finally {\n      try {\n        if (!_n && _i[\"return\"]) _i[\"return\"]();\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n\n    return _arr;\n  }\n\n  return function (arr, i) {\n    if (Array.isArray(arr)) {\n      return arr;\n    } else if (Symbol.iterator in Object(arr)) {\n      return sliceIterator(arr, i);\n    } else {\n      throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n    }\n  };\n}();\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n}\n\nfunction _toConsumableArray(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  } else {\n    return Array.from(arr);\n  }\n}\n\nvar constants = require('./constants');\n\nvar E = constants.typeErrors,\n    trackPriority = constants.trackPriority;\n\nvar util = require('@twilio/webrtc/lib/util');\n/**\r\n * Return the given {@link LocalTrack} or a new {@link LocalTrack} for the\r\n * given MediaStreamTrack.\r\n * @param {LocalTrack|MediaStreamTrack} track\r\n * @param {object} options\r\n * @returns {LocalTrack}\r\n * @throws {TypeError}\r\n */\n\n\nfunction asLocalTrack(track, options) {\n  if (track instanceof options.LocalAudioTrack || track instanceof options.LocalVideoTrack || track instanceof options.LocalDataTrack) {\n    return track;\n  }\n\n  if (track instanceof options.MediaStreamTrack) {\n    return track.kind === 'audio' ? new options.LocalAudioTrack(track, options) : new options.LocalVideoTrack(track, options);\n  }\n  /* eslint new-cap:0 */\n\n\n  throw E.INVALID_TYPE('track', 'LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack');\n}\n/**\r\n * Create a new {@link LocalTrackPublication} for the given {@link LocalTrack}.\r\n * @param {LocalTrack} track\r\n * @param {LocalTrackPublicationSignaling} signaling\r\n * @param {function(track: LocalTrackPublication): void} unpublish\r\n * @param {object} options\r\n */\n\n\nfunction asLocalTrackPublication(track, signaling, unpublish, options) {\n  var LocalTrackPublication = {\n    audio: options.LocalAudioTrackPublication,\n    video: options.LocalVideoTrackPublication,\n    data: options.LocalDataTrackPublication\n  }[track.kind];\n  return new LocalTrackPublication(signaling, track, unpublish, options);\n}\n/**\r\n * Capitalize a word.\r\n * @param {string} word\r\n * @returns {string} capitalized\r\n */\n\n\nfunction capitalize(word) {\n  return word[0].toUpperCase() + word.slice(1);\n}\n/**\r\n * Log deprecation warnings for the given events of an EventEmitter.\r\n * @param {string} name\r\n * @param {EventEmitter} emitter\r\n * @param {Map<string, string>} events\r\n * @param {Log} log\r\n */\n\n\nfunction deprecateEvents(name, emitter, events, log) {\n  var warningsShown = new Set();\n  emitter.on('newListener', function newListener(event) {\n    if (events.has(event) && !warningsShown.has(event)) {\n      log.deprecated(name + '#' + event + ' has been deprecated and scheduled for removal in twilio-video.js@2.0.0.' + (events.get(event) ? ' Use ' + name + '#' + events.get(event) + ' instead.' : ''));\n      warningsShown.add(event);\n    }\n\n    if (warningsShown.size >= events.size) {\n      emitter.removeListener('newListener', newListener);\n    }\n  });\n}\n/**\r\n * Finds the items in list1 that are not in list2.\r\n * @param {Array<*>|Map<*>|Set<*>} list1\r\n * @param {Array<*>|Map<*>|Set<*>} list2\r\n * @returns {Set}\r\n */\n\n\nfunction difference(list1, list2) {\n  list1 = Array.isArray(list1) ? new Set(list1) : new Set(list1.values());\n  list2 = Array.isArray(list2) ? new Set(list2) : new Set(list2.values());\n  var difference = new Set();\n  list1.forEach(function (item) {\n    if (!list2.has(item)) {\n      difference.add(item);\n    }\n  });\n  return difference;\n}\n/**\r\n * Filter out the keys in an object with a given value.\r\n * @param {object} object - Object to be filtered\r\n * @param {*} [filterValue] - Value to be filtered out; If not specified, then\r\n *   filters out all keys which have an explicit value of \"undefined\"\r\n * @returns {object} - Filtered object\r\n */\n\n\nfunction filterObject(object, filterValue) {\n  return Object.keys(object).reduce(function (filtered, key) {\n    if (object[key] !== filterValue) {\n      filtered[key] = object[key];\n    }\n\n    return filtered;\n  }, {});\n}\n/**\r\n * Map a list to an array of arrays, and return the flattened result.\r\n * @param {Array<*>|Set<*>|Map<*>} list\r\n * @param {function(*): Array<*>} [mapFn]\r\n * @returns Array<*>\r\n */\n\n\nfunction flatMap(list, mapFn) {\n  var listArray = list instanceof Map || list instanceof Set ? Array.from(list.values()) : list;\n\n  mapFn = mapFn || function mapFn(item) {\n    return item;\n  };\n\n  return listArray.reduce(function (flattened, item) {\n    var mapped = mapFn(item);\n    return flattened.concat(mapped);\n  }, []);\n}\n/**\r\n * Get the user agent string, or return \"Unknown\".\r\n * @returns {string}\r\n */\n\n\nfunction getUserAgent() {\n  return typeof navigator !== 'undefined' && navigator.userAgent ? navigator.userAgent : 'Unknown';\n}\n/**\r\n * Get the platform component of the user agent string.\r\n * Example:\r\n *   Input - Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.82 Safari/537.36\r\n *   Output - macintosh\r\n * @returns {string}\r\n */\n\n\nfunction getPlatform() {\n  var userAgent = getUserAgent();\n\n  var _ref = userAgent.match(/\\(([^)]+)\\)/) || [],\n      _ref2 = _slicedToArray(_ref, 2),\n      _ref2$ = _ref2[1],\n      match = _ref2$ === undefined ? 'unknown' : _ref2$;\n\n  var _match$split$map = match.split(';').map(function (entry) {\n    return entry.trim();\n  }),\n      _match$split$map2 = _slicedToArray(_match$split$map, 1),\n      platform = _match$split$map2[0];\n\n  return platform.toLowerCase();\n}\n/**\r\n * Create a unique identifier.\r\n * @returns {string}\r\n */\n\n\nfunction makeUUID() {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n    var r = Math.random() * 16 | 0;\n    var v = c === 'x' ? r : r & 0x3 | 0x8;\n    return v.toString(16);\n  });\n}\n/**\r\n * Ensure that the given function is called once per tick.\r\n * @param {function} fn - Function to be executed\r\n * @returns {function} - Schedules the given function to be called on the next tick\r\n */\n\n\nfunction oncePerTick(fn) {\n  var timeout = null;\n\n  function nextTick() {\n    timeout = null;\n    fn();\n  }\n\n  return function scheduleNextTick() {\n    if (timeout) {\n      clearTimeout(timeout);\n    }\n\n    timeout = setTimeout(nextTick);\n  };\n}\n\nfunction promiseFromEvents(operation, eventEmitter, successEvent, failureEvent) {\n  return new Promise(function (resolve, reject) {\n    function onSuccess() {\n      var args = [].slice.call(arguments);\n\n      if (failureEvent) {\n        eventEmitter.removeListener(failureEvent, onFailure);\n      }\n\n      resolve.apply(undefined, _toConsumableArray(args));\n    }\n\n    function onFailure() {\n      var args = [].slice.call(arguments);\n      eventEmitter.removeListener(successEvent, onSuccess);\n      reject.apply(undefined, _toConsumableArray(args));\n    }\n\n    eventEmitter.once(successEvent, onSuccess);\n\n    if (failureEvent) {\n      eventEmitter.once(failureEvent, onFailure);\n    }\n\n    operation();\n  });\n}\n/**\r\n * Traverse down multiple nodes on an object and return null if\r\n * any link in the path is unavailable.\r\n * @param {Object} obj - Object to traverse\r\n * @param {String} path - Path to traverse. Period-separated.\r\n * @returns {Any|null}\r\n */\n\n\nfunction getOrNull(obj, path) {\n  return path.split('.').reduce(function (output, step) {\n    if (!output) {\n      return null;\n    }\n\n    return output[step];\n  }, obj);\n}\n/**\r\n * @typedef {object} Deferred\r\n * @property {Promise} promise\r\n * @property {function} reject\r\n * @property {function} resolve\r\n */\n\n/**\r\n * Create a {@link Deferred}.\r\n * @returns {Deferred}\r\n */\n\n\nfunction defer() {\n  var deferred = {};\n  deferred.promise = new Promise(function (resolve, reject) {\n    deferred.resolve = resolve;\n    deferred.reject = reject;\n  });\n  return deferred;\n}\n/**\r\n * Copy a method from a `source` prototype onto a `wrapper` prototype. Invoking\r\n * the method on the `wrapper` prototype will invoke the corresponding method\r\n * on an instance accessed by `target`.\r\n * @param {object} source\r\n * @param {object} wrapper\r\n * @param {string} target\r\n * @param {string} methodName\r\n * @returns {undefined}\r\n */\n\n\nfunction delegateMethod(source, wrapper, target, methodName) {\n  if (methodName in wrapper) {\n    // Skip any methods already set.\n    return;\n  } else if (methodName.match(/^on[a-z]+$/)) {\n    // Skip EventHandlers (these are handled in the constructor).\n    return;\n  }\n\n  var type = void 0;\n\n  try {\n    type = _typeof(source[methodName]);\n  } catch (error) {// NOTE(mroberts): Attempting to check the type of non-function members\n    // on the prototype throws an error for some types.\n  }\n\n  if (type !== 'function') {\n    // Skip non-function members.\n    return;\n  }\n  /* eslint no-loop-func:0 */\n\n\n  wrapper[methodName] = function () {\n    var _target;\n\n    return (_target = this[target])[methodName].apply(_target, arguments);\n  };\n}\n/**\r\n * Copy methods from a `source` prototype onto a `wrapper` prototype. Invoking\r\n * the methods on the `wrapper` prototype will invoke the corresponding method\r\n * on an instance accessed by `target`.\r\n * @param {object} source\r\n * @param {object} wrapper\r\n * @param {string} target\r\n * @returns {undefined}\r\n */\n\n\nfunction delegateMethods(source, wrapper, target) {\n  for (var methodName in source) {\n    delegateMethod(source, wrapper, target, methodName);\n  }\n}\n/**\r\n * Determine whether two values are deeply equal.\r\n * @param {*} val1\r\n * @param {*} val2\r\n * @returns {boolean}\r\n */\n\n\nfunction isDeepEqual(val1, val2) {\n  if (val1 === val2) {\n    return true;\n  }\n\n  if ((typeof val1 === 'undefined' ? 'undefined' : _typeof(val1)) !== (typeof val2 === 'undefined' ? 'undefined' : _typeof(val2))) {\n    return false;\n  }\n\n  if (val1 === null) {\n    return val2 === null;\n  }\n\n  if (val2 === null) {\n    return false;\n  }\n\n  if (Array.isArray(val1)) {\n    return Array.isArray(val2) && val1.length === val2.length && val1.every(function (val, i) {\n      return isDeepEqual(val, val2[i]);\n    });\n  }\n\n  if ((typeof val1 === 'undefined' ? 'undefined' : _typeof(val1)) === 'object') {\n    var val1Keys = Object.keys(val1).sort();\n    var val2Keys = Object.keys(val2).sort();\n    return !Array.isArray(val2) && isDeepEqual(val1Keys, val2Keys) && val1Keys.every(function (key) {\n      return isDeepEqual(val1[key], val2[key]);\n    });\n  }\n\n  return false;\n}\n/**\r\n * Whether the given argument is a non-array object.\r\n * @param {*} object\r\n * @return {boolean}\r\n */\n\n\nfunction isNonArrayObject(object) {\n  return (typeof object === 'undefined' ? 'undefined' : _typeof(object)) === 'object' && !Array.isArray(object);\n}\n/**\r\n * For each property name on the `source` prototype, add getters and/or setters\r\n * to `wrapper` that proxy to `target`.\r\n * @param {object} source\r\n * @param {object} wrapper\r\n * @param {string} target\r\n * @returns {undefined}\r\n */\n\n\nfunction proxyProperties(source, wrapper, target) {\n  Object.getOwnPropertyNames(source).forEach(function (propertyName) {\n    proxyProperty(source, wrapper, target, propertyName);\n  });\n}\n/**\r\n * For the property name on the `source` prototype, add a getter and/or setter\r\n * to `wrapper` that proxies to `target`.\r\n * @param {object} source\r\n * @param {object} wrapper\r\n * @param {string} target\r\n * @param {string} propertyName\r\n * @returns {undefined}\r\n */\n\n\nfunction proxyProperty(source, wrapper, target, propertyName) {\n  if (propertyName in wrapper) {\n    // Skip any properties already set.\n    return;\n  } else if (propertyName.match(/^on[a-z]+$/)) {\n    Object.defineProperty(wrapper, propertyName, {\n      value: null,\n      writable: true\n    });\n    target.addEventListener(propertyName.slice(2), function () {\n      wrapper.dispatchEvent.apply(wrapper, arguments);\n    });\n    return;\n  }\n\n  Object.defineProperty(wrapper, propertyName, {\n    enumerable: true,\n    get: function get() {\n      return target[propertyName];\n    }\n  });\n}\n/**\r\n * This is a function for turning a Promise into the kind referenced in the\r\n * Legacy Interface Extensions section of the WebRTC spec.\r\n * @param {Promise<*>} promise\r\n * @param {function<*>} onSuccess\r\n * @param {function<Error>} onFailure\r\n * @returns {Promise<undefined>}\r\n */\n\n\nfunction legacyPromise(promise, onSuccess, onFailure) {\n  if (onSuccess) {\n    return promise.then(function (result) {\n      onSuccess(result);\n    }, function (error) {\n      onFailure(error);\n    });\n  }\n\n  return promise;\n}\n/**\r\n * Build the {@link LogLevels} object.\r\n * @param {String|LogLevel} logLevel - Log level name or object\r\n * @returns {LogLevels}\r\n */\n\n\nfunction buildLogLevels(logLevel) {\n  if (typeof logLevel === 'string') {\n    return {\n      default: logLevel,\n      media: logLevel,\n      signaling: logLevel,\n      webrtc: logLevel\n    };\n  }\n\n  return logLevel;\n}\n/**\r\n * Get the {@link Track}'s derived class name\r\n * @param {Track} track\r\n * @param {?boolean} [local=undefined]\r\n * @returns {string}\r\n */\n\n\nfunction trackClass(track, local) {\n  local = local ? 'Local' : '';\n  return local + (track.kind || '').replace(/\\w{1}/, function (m) {\n    return m.toUpperCase();\n  }) + 'Track';\n}\n/**\r\n * Get the {@link TrackPublication}'s derived class name\r\n * @param {TrackPublication} publication\r\n * @param {?boolean} [local=undefined]\r\n * @returns {string}\r\n */\n\n\nfunction trackPublicationClass(publication, local) {\n  local = local ? 'Local' : '';\n  return local + (publication.kind || '').replace(/\\w{1}/, function (m) {\n    return m.toUpperCase();\n  }) + 'TrackPublication';\n}\n/**\r\n * Sets all underscore-prefixed properties on `object` non-enumerable.\r\n * @param {Object} object\r\n * @returns {void}\r\n */\n\n\nfunction hidePrivateProperties(object) {\n  Object.getOwnPropertyNames(object).forEach(function (name) {\n    if (name.startsWith('_')) {\n      hideProperty(object, name);\n    }\n  });\n}\n/**\r\n * Creates a new subclass which, in the constructor, sets all underscore-prefixed\r\n * properties and the given public properties non-enumerable. This is useful for\r\n * patching up classes like EventEmitter which may set properties like `_events`\r\n * and `domain`.\r\n * @param {Function} klass\r\n * @param {Array<string>} props\r\n * @returns {Function} subclass\r\n */\n\n\nfunction hidePrivateAndCertainPublicPropertiesInClass(klass, props) {\n  // NOTE(mroberts): We do this to avoid giving the class a name.\n  return function (_klass) {\n    _inherits(_class, _klass);\n\n    function _class() {\n      var _ref3;\n\n      _classCallCheck(this, _class);\n\n      for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      var _this = _possibleConstructorReturn(this, (_ref3 = _class.__proto__ || Object.getPrototypeOf(_class)).call.apply(_ref3, [this].concat(args)));\n\n      hidePrivateProperties(_this);\n      hidePublicProperties(_this, props);\n      return _this;\n    }\n\n    return _class;\n  }(klass);\n}\n/**\r\n * Hide a property of an object.\r\n * @param {object} object\r\n * @param {string} name\r\n */\n\n\nfunction hideProperty(object, name) {\n  var descriptor = Object.getOwnPropertyDescriptor(object, name);\n  descriptor.enumerable = false;\n  Object.defineProperty(object, name, descriptor);\n}\n/**\r\n * Hide the given public properties of an object.\r\n * @param {object} object\r\n * @param {Array<string>} [props=[]]\r\n */\n\n\nfunction hidePublicProperties(object) {\n  var props = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n  props.forEach(function (name) {\n    // eslint-disable-next-line no-prototype-builtins\n    if (object.hasOwnProperty(name)) {\n      hideProperty(object, name);\n    }\n  });\n}\n/**\r\n * Convert an Array of values to an Array of JSON values by calling\r\n * `valueToJSON` on each value.\r\n * @param {Array<*>} array\r\n * @returns {Array<*>}\r\n */\n\n\nfunction arrayToJSON(array) {\n  return array.map(valueToJSON);\n}\n/**\r\n * Convert a Set of values to an Array of JSON values by calling `valueToJSON`\r\n * on each value.\r\n * @param {Set<*>} set\r\n * @returns {Array<*>}\r\n */\n\n\nfunction setToJSON(set) {\n  return arrayToJSON([].concat(_toConsumableArray(set)));\n}\n/**\r\n * Convert a Map from strings to values to an object of JSON values by calling\r\n * `valueToJSON` on each value.\r\n * @param {Map<string, *>} map\r\n * @returns {object}\r\n */\n\n\nfunction mapToJSON(map) {\n  return [].concat(_toConsumableArray(map.entries())).reduce(function (json, _ref4) {\n    var _ref5 = _slicedToArray(_ref4, 2),\n        key = _ref5[0],\n        value = _ref5[1];\n\n    return Object.assign(_defineProperty({}, key, valueToJSON(value)), json);\n  }, {});\n}\n/**\r\n * Convert an object to a JSON value by calling `valueToJSON` on its enumerable\r\n * keys.\r\n * @param {object} object\r\n * @returns {object}\r\n */\n\n\nfunction objectToJSON(object) {\n  return Object.entries(object).reduce(function (json, _ref6) {\n    var _ref7 = _slicedToArray(_ref6, 2),\n        key = _ref7[0],\n        value = _ref7[1];\n\n    return Object.assign(_defineProperty({}, key, valueToJSON(value)), json);\n  }, {});\n}\n/**\r\n * Convert a value into a JSON value.\r\n * @param {*} value\r\n * @returns {*}\r\n */\n\n\nfunction valueToJSON(value) {\n  if (Array.isArray(value)) {\n    return arrayToJSON(value);\n  } else if (value instanceof Set) {\n    return setToJSON(value);\n  } else if (value instanceof Map) {\n    return mapToJSON(value);\n  } else if (value && (typeof value === 'undefined' ? 'undefined' : _typeof(value)) === 'object') {\n    return objectToJSON(value);\n  }\n\n  return value;\n}\n\nfunction createRoomConnectEventPayload(connectOptions) {\n  function boolToString(val) {\n    return val ? 'true' : 'false';\n  }\n\n  var payload = {\n    // arrays props converted to lengths.\n    iceServers: (connectOptions.iceServers || []).length,\n    audioTracks: (connectOptions.tracks || []).filter(function (track) {\n      return track.kind === 'audio';\n    }).length,\n    videoTracks: (connectOptions.tracks || []).filter(function (track) {\n      return track.kind === 'video';\n    }).length,\n    dataTracks: (connectOptions.tracks || []).filter(function (track) {\n      return track.kind === 'data';\n    }).length\n  }; // boolean properties.\n\n  [['audio'], ['automaticSubscription'], ['enableDscp'], ['eventListener'], ['preflight'], ['video'], ['dominantSpeaker', 'enableDominantSpeaker']].forEach(function (_ref8) {\n    var _ref9 = _slicedToArray(_ref8, 2),\n        prop = _ref9[0],\n        eventProp = _ref9[1];\n\n    eventProp = eventProp || prop;\n    payload[eventProp] = boolToString(!!connectOptions[prop]);\n  }); // numbers and string properties.\n\n  [['maxVideoBitrate'], ['maxAudioBitrate'], ['iceTransportPolicy'], ['region'], ['name', 'roomName']].forEach(function (_ref10) {\n    var _ref11 = _slicedToArray(_ref10, 2),\n        prop = _ref11[0],\n        eventProp = _ref11[1];\n\n    eventProp = eventProp || prop;\n\n    if (typeof connectOptions[prop] === 'number' || typeof connectOptions[prop] === 'string') {\n      payload[eventProp] = connectOptions[prop];\n    }\n  }); // array props stringified.\n\n  ['preferredAudioCodecs', 'preferredVideoCodecs'].forEach(function (prop) {\n    if (prop in connectOptions) {\n      payload[prop] = JSON.stringify(connectOptions[prop]);\n    }\n  });\n\n  if ('networkQuality' in connectOptions) {\n    payload.networkQualityConfiguration = {};\n\n    if (isNonArrayObject(connectOptions.networkQuality)) {\n      ['local', 'remote'].forEach(function (prop) {\n        if (typeof connectOptions.networkQuality[prop] === 'number') {\n          payload.networkQualityConfiguration[prop] = connectOptions.networkQuality[prop];\n        }\n      });\n    } else {\n      payload.networkQualityConfiguration.remote = 0;\n      payload.networkQualityConfiguration.local = connectOptions.networkQuality ? 1 : 0;\n    }\n  }\n\n  if (connectOptions.bandwidthProfile && connectOptions.bandwidthProfile.video) {\n    var videoBPOptions = connectOptions.bandwidthProfile.video || {};\n    payload.bandwidthProfileOptions = {};\n    ['mode', 'maxTracks', 'trackSwitchOffMode', 'dominantSpeakerPriority', 'maxSubscriptionBitrate'].forEach(function (prop) {\n      if (typeof videoBPOptions[prop] === 'number' || typeof videoBPOptions[prop] === 'string') {\n        if (prop in videoBPOptions) {\n          payload.bandwidthProfileOptions[prop] = videoBPOptions[prop];\n        }\n      }\n    });\n\n    if ('renderDimensions' in videoBPOptions) {\n      payload.bandwidthProfileOptions.renderDimensions = JSON.stringify(videoBPOptions.renderDimensions);\n    }\n  }\n\n  return {\n    group: 'room',\n    name: 'connect',\n    level: 'info',\n    payload: payload\n  };\n}\n/**\r\n * Create the bandwidth profile payload included in an RSP connect message.\r\n * @param {BandwidthProfileOptions} bandwidthProfile\r\n * @returns {object}\r\n */\n\n\nfunction createBandwidthProfilePayload(bandwidthProfile) {\n  return createRSPPayload(bandwidthProfile, [{\n    prop: 'video',\n    type: 'object',\n    transform: createBandwidthProfileVideoPayload\n  }]);\n}\n/**\r\n * Create the bandwidth profile video payload included in an RSP connect message.\r\n * @param {VideoBandwidthProfileOptions} bandwidthProfileVideo\r\n * @returns {object}\r\n */\n\n\nfunction createBandwidthProfileVideoPayload(bandwidthProfileVideo) {\n  return createRSPPayload(bandwidthProfileVideo, [{\n    prop: 'dominantSpeakerPriority',\n    type: 'string',\n    payloadProp: 'active_speaker_priority'\n  }, {\n    prop: 'maxSubscriptionBitrate',\n    type: 'number',\n    payloadProp: 'max_subscription_bandwidth'\n  }, {\n    prop: 'maxTracks',\n    type: 'number',\n    payloadProp: 'max_tracks'\n  }, {\n    prop: 'mode',\n    type: 'string'\n  }, {\n    prop: 'renderDimensions',\n    type: 'object',\n    payloadProp: 'render_dimensions',\n    transform: createRenderDimensionsPayload\n  }, {\n    prop: 'trackSwitchOffMode',\n    type: 'string',\n    payloadProp: 'track_switch_off'\n  }]);\n}\n/**\r\n * Create the Media Signaling payload included in an RSP connect message.\r\n * @param {boolean} dominantSpeaker - whether to enable the Dominant Speaker\r\n *   protocol or not\r\n * @param {boolean} networkQuality - whether to enable the Network Quality\r\n *   protocol or not\r\n * @param {boolean} trackPriority - whether to enable the Track Priority\r\n *   protocol or not\r\n * @param {boolean} trackSwitchOff - whether to enable the Track Switch-Off\r\n *   protocol or not.\r\n * @returns {object}\r\n */\n\n\nfunction createMediaSignalingPayload(dominantSpeaker, networkQuality, trackPriority, trackSwitchOff) {\n  var transports = {\n    transports: [{\n      type: 'data-channel'\n    }]\n  };\n  return Object.assign(dominantSpeaker // eslint-disable-next-line\n  ? {\n    active_speaker: transports\n  } : {}, networkQuality // eslint-disable-next-line\n  ? {\n    network_quality: transports\n  } : {}, trackPriority // eslint-disable-next-line\n  ? {\n    track_priority: transports\n  } : {}, trackSwitchOff // eslint-disable-next-line\n  ? {\n    track_switch_off: transports\n  } : {});\n}\n/**\r\n * Create {@link VideoTrack.Dimensions} RSP payload.\r\n * @param {VideoTrack.Dimensions} [dimensions]\r\n * @returns {object}\r\n */\n\n\nfunction createDimensionsPayload(dimensions) {\n  return createRSPPayload(dimensions, [{\n    prop: 'height',\n    type: 'number'\n  }, {\n    prop: 'width',\n    type: 'number'\n  }]);\n}\n/**\r\n * Create {@link VideoRenderDimensions} RSP payload.\r\n * @param renderDimensions\r\n * @returns {object}\r\n */\n\n\nfunction createRenderDimensionsPayload(renderDimensions) {\n  var PRIORITY_HIGH = trackPriority.PRIORITY_HIGH,\n      PRIORITY_LOW = trackPriority.PRIORITY_LOW,\n      PRIORITY_STANDARD = trackPriority.PRIORITY_STANDARD;\n  return createRSPPayload(renderDimensions, [{\n    prop: PRIORITY_HIGH,\n    type: 'object',\n    transform: createDimensionsPayload\n  }, {\n    prop: PRIORITY_LOW,\n    type: 'object',\n    transform: createDimensionsPayload\n  }, {\n    prop: PRIORITY_STANDARD,\n    type: 'object',\n    transform: createDimensionsPayload\n  }]);\n}\n/**\r\n * Create an RSP payload for the given object.\r\n * @param {object} object - object for which RSP payload is to be generated\r\n * @param {Array<object>} propConversions - conversion rules for object properties;\r\n *   they specify how object properties should be converted to their corresponding\r\n *   RSP payload properties\r\n * @returns {object}\r\n */\n\n\nfunction createRSPPayload(object, propConversions) {\n  return propConversions.reduce(function (payload, _ref12) {\n    var prop = _ref12.prop,\n        type = _ref12.type,\n        _ref12$payloadProp = _ref12.payloadProp,\n        payloadProp = _ref12$payloadProp === undefined ? prop : _ref12$payloadProp,\n        _ref12$transform = _ref12.transform,\n        transform = _ref12$transform === undefined ? function (x) {\n      return x;\n    } : _ref12$transform;\n    return _typeof(object[prop]) === type ? Object.assign(_defineProperty({}, payloadProp, transform(object[prop])), payload) : payload;\n  }, {});\n}\n/**\r\n * Create the subscribe payload included in an RSP connect/update message.\r\n * @param {boolean} automaticSubscription - whether to subscribe to all RemoteTracks\r\n * @returns {object}\r\n */\n\n\nfunction createSubscribePayload(automaticSubscription) {\n  return {\n    rules: [{\n      type: automaticSubscription ? 'include' : 'exclude',\n      all: true\n    }],\n    revision: 1\n  };\n}\n/**\r\n * Add random jitter to a given value in the range [-jitter, jitter].\r\n * @private\r\n * @param {number} value\r\n * @param {number} jitter\r\n * @returns {number} value + random(-jitter, +jitter)\r\n */\n\n\nfunction withJitter(value, jitter) {\n  var rand = Math.random();\n  return value - jitter + Math.floor(2 * jitter * rand + 0.5);\n}\n/**\r\n * Checks if the a number is in the range [min, max].\r\n * @private\r\n * @param {num} num\r\n * @param {number} min\r\n * @param {number} max\r\n * @return {boolean}\r\n */\n\n\nfunction inRange(num, min, max) {\n  return min <= num && num <= max;\n}\n/**\r\n * returns true if given MediaStreamTrack is a screen share track\r\n * @private\r\n * @param {MediaStreamTrack} track\r\n * @returns {boolean}\r\n */\n\n\nfunction isChromeScreenShareTrack(track) {\n  // NOTE(mpatwardhan): Chrome creates screen share tracks with label like: \"screen:69734272*\"\n  // we will check for label that starts with \"screen:D\" where D being a digit.\n  var isChrome = util.guessBrowser() === 'chrome';\n  return isChrome && track.kind === 'video' && track.label && (/^screen:[0-9]+/.test(track.label) || /^web-contents-media-stream:[0-9/]+/.test(track.label) || /^window:[0-9]+/.test(track.label));\n}\n/**\r\n * Returns a promise that resolve after timeoutMS have passed.\r\n * @param {number} timeoutMS - time to wait in milliseconds.\r\n * @returns {Promise<void>}\r\n */\n\n\nfunction waitForSometime() {\n  var timeoutMS = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 10;\n  return new Promise(function (resolve) {\n    return setTimeout(resolve, timeoutMS);\n  });\n}\n/**\r\n * Returns a promise that resolve after event is received\r\n * @returns {Promise<void>}\r\n */\n\n\nfunction waitForEvent(eventTarget, event) {\n  return new Promise(function (resolve) {\n    eventTarget.addEventListener(event, function onevent(e) {\n      eventTarget.removeEventListener(event, onevent);\n      resolve(e);\n    });\n  });\n}\n\nexports.constants = constants;\nexports.createBandwidthProfilePayload = createBandwidthProfilePayload;\nexports.createMediaSignalingPayload = createMediaSignalingPayload;\nexports.createRoomConnectEventPayload = createRoomConnectEventPayload;\nexports.createSubscribePayload = createSubscribePayload;\nexports.asLocalTrack = asLocalTrack;\nexports.asLocalTrackPublication = asLocalTrackPublication;\nexports.capitalize = capitalize;\nexports.deprecateEvents = deprecateEvents;\nexports.difference = difference;\nexports.filterObject = filterObject;\nexports.flatMap = flatMap;\nexports.getPlatform = getPlatform;\nexports.getUserAgent = getUserAgent;\nexports.hidePrivateProperties = hidePrivateProperties;\nexports.hidePrivateAndCertainPublicPropertiesInClass = hidePrivateAndCertainPublicPropertiesInClass;\nexports.isDeepEqual = isDeepEqual;\nexports.isNonArrayObject = isNonArrayObject;\nexports.inRange = inRange;\nexports.makeUUID = makeUUID;\nexports.oncePerTick = oncePerTick;\nexports.promiseFromEvents = promiseFromEvents;\nexports.getOrNull = getOrNull;\nexports.defer = defer;\nexports.delegateMethods = delegateMethods;\nexports.proxyProperties = proxyProperties;\nexports.legacyPromise = legacyPromise;\nexports.buildLogLevels = buildLogLevels;\nexports.trackClass = trackClass;\nexports.trackPublicationClass = trackPublicationClass;\nexports.valueToJSON = valueToJSON;\nexports.withJitter = withJitter;\nexports.isChromeScreenShareTrack = isChromeScreenShareTrack;\nexports.waitForSometime = waitForSometime;\nexports.waitForEvent = waitForEvent;","map":{"version":3,"sources":["C:/Users/IJuanchoG/Desktop/Twilio/node_modules/twilio-video/es5/util/index.js"],"names":["_typeof","Symbol","iterator","obj","constructor","prototype","_slicedToArray","sliceIterator","arr","i","_arr","_n","_d","_e","undefined","_i","_s","next","done","push","value","length","err","Array","isArray","Object","TypeError","_defineProperty","key","defineProperty","enumerable","configurable","writable","_classCallCheck","instance","Constructor","_possibleConstructorReturn","self","call","ReferenceError","_inherits","subClass","superClass","create","setPrototypeOf","__proto__","_toConsumableArray","arr2","from","constants","require","E","typeErrors","trackPriority","util","asLocalTrack","track","options","LocalAudioTrack","LocalVideoTrack","LocalDataTrack","MediaStreamTrack","kind","INVALID_TYPE","asLocalTrackPublication","signaling","unpublish","LocalTrackPublication","audio","LocalAudioTrackPublication","video","LocalVideoTrackPublication","data","LocalDataTrackPublication","capitalize","word","toUpperCase","slice","deprecateEvents","name","emitter","events","log","warningsShown","Set","on","newListener","event","has","deprecated","get","add","size","removeListener","difference","list1","list2","values","forEach","item","filterObject","object","filterValue","keys","reduce","filtered","flatMap","list","mapFn","listArray","Map","flattened","mapped","concat","getUserAgent","navigator","userAgent","getPlatform","_ref","match","_ref2","_ref2$","_match$split$map","split","map","entry","trim","_match$split$map2","platform","toLowerCase","makeUUID","replace","c","r","Math","random","v","toString","oncePerTick","fn","timeout","nextTick","scheduleNextTick","clearTimeout","setTimeout","promiseFromEvents","operation","eventEmitter","successEvent","failureEvent","Promise","resolve","reject","onSuccess","args","arguments","onFailure","apply","once","getOrNull","path","output","step","defer","deferred","promise","delegateMethod","source","wrapper","target","methodName","type","error","_target","delegateMethods","isDeepEqual","val1","val2","every","val","val1Keys","sort","val2Keys","isNonArrayObject","proxyProperties","getOwnPropertyNames","propertyName","proxyProperty","addEventListener","dispatchEvent","legacyPromise","then","result","buildLogLevels","logLevel","default","media","webrtc","trackClass","local","m","trackPublicationClass","publication","hidePrivateProperties","startsWith","hideProperty","hidePrivateAndCertainPublicPropertiesInClass","klass","props","_klass","_class","_ref3","_len","_key","_this","getPrototypeOf","hidePublicProperties","descriptor","getOwnPropertyDescriptor","hasOwnProperty","arrayToJSON","array","valueToJSON","setToJSON","set","mapToJSON","entries","json","_ref4","_ref5","assign","objectToJSON","_ref6","_ref7","createRoomConnectEventPayload","connectOptions","boolToString","payload","iceServers","audioTracks","tracks","filter","videoTracks","dataTracks","_ref8","_ref9","prop","eventProp","_ref10","_ref11","JSON","stringify","networkQualityConfiguration","networkQuality","remote","bandwidthProfile","videoBPOptions","bandwidthProfileOptions","renderDimensions","group","level","createBandwidthProfilePayload","createRSPPayload","transform","createBandwidthProfileVideoPayload","bandwidthProfileVideo","payloadProp","createRenderDimensionsPayload","createMediaSignalingPayload","dominantSpeaker","trackSwitchOff","transports","active_speaker","network_quality","track_priority","track_switch_off","createDimensionsPayload","dimensions","PRIORITY_HIGH","PRIORITY_LOW","PRIORITY_STANDARD","propConversions","_ref12","_ref12$payloadProp","_ref12$transform","x","createSubscribePayload","automaticSubscription","rules","all","revision","withJitter","jitter","rand","floor","inRange","num","min","max","isChromeScreenShareTrack","isChrome","guessBrowser","label","test","waitForSometime","timeoutMS","waitForEvent","eventTarget","onevent","e","removeEventListener","exports"],"mappings":"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","sourcesContent":["'use strict';\r\n\r\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\r\n\r\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\r\n\r\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\r\n\r\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\r\n\r\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\r\n\r\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\r\n\r\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\r\n\r\nvar constants = require('./constants');\r\nvar E = constants.typeErrors,\r\n    trackPriority = constants.trackPriority;\r\n\r\nvar util = require('@twilio/webrtc/lib/util');\r\n\r\n/**\r\n * Return the given {@link LocalTrack} or a new {@link LocalTrack} for the\r\n * given MediaStreamTrack.\r\n * @param {LocalTrack|MediaStreamTrack} track\r\n * @param {object} options\r\n * @returns {LocalTrack}\r\n * @throws {TypeError}\r\n */\r\nfunction asLocalTrack(track, options) {\r\n  if (track instanceof options.LocalAudioTrack || track instanceof options.LocalVideoTrack || track instanceof options.LocalDataTrack) {\r\n    return track;\r\n  }\r\n  if (track instanceof options.MediaStreamTrack) {\r\n    return track.kind === 'audio' ? new options.LocalAudioTrack(track, options) : new options.LocalVideoTrack(track, options);\r\n  }\r\n  /* eslint new-cap:0 */\r\n  throw E.INVALID_TYPE('track', 'LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack');\r\n}\r\n\r\n/**\r\n * Create a new {@link LocalTrackPublication} for the given {@link LocalTrack}.\r\n * @param {LocalTrack} track\r\n * @param {LocalTrackPublicationSignaling} signaling\r\n * @param {function(track: LocalTrackPublication): void} unpublish\r\n * @param {object} options\r\n */\r\nfunction asLocalTrackPublication(track, signaling, unpublish, options) {\r\n  var LocalTrackPublication = {\r\n    audio: options.LocalAudioTrackPublication,\r\n    video: options.LocalVideoTrackPublication,\r\n    data: options.LocalDataTrackPublication\r\n  }[track.kind];\r\n  return new LocalTrackPublication(signaling, track, unpublish, options);\r\n}\r\n\r\n/**\r\n * Capitalize a word.\r\n * @param {string} word\r\n * @returns {string} capitalized\r\n */\r\nfunction capitalize(word) {\r\n  return word[0].toUpperCase() + word.slice(1);\r\n}\r\n\r\n/**\r\n * Log deprecation warnings for the given events of an EventEmitter.\r\n * @param {string} name\r\n * @param {EventEmitter} emitter\r\n * @param {Map<string, string>} events\r\n * @param {Log} log\r\n */\r\nfunction deprecateEvents(name, emitter, events, log) {\r\n  var warningsShown = new Set();\r\n  emitter.on('newListener', function newListener(event) {\r\n    if (events.has(event) && !warningsShown.has(event)) {\r\n      log.deprecated(name + '#' + event + ' has been deprecated and scheduled for removal in twilio-video.js@2.0.0.' + (events.get(event) ? ' Use ' + name + '#' + events.get(event) + ' instead.' : ''));\r\n      warningsShown.add(event);\r\n    }\r\n    if (warningsShown.size >= events.size) {\r\n      emitter.removeListener('newListener', newListener);\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Finds the items in list1 that are not in list2.\r\n * @param {Array<*>|Map<*>|Set<*>} list1\r\n * @param {Array<*>|Map<*>|Set<*>} list2\r\n * @returns {Set}\r\n */\r\nfunction difference(list1, list2) {\r\n  list1 = Array.isArray(list1) ? new Set(list1) : new Set(list1.values());\r\n  list2 = Array.isArray(list2) ? new Set(list2) : new Set(list2.values());\r\n\r\n  var difference = new Set();\r\n\r\n  list1.forEach(function (item) {\r\n    if (!list2.has(item)) {\r\n      difference.add(item);\r\n    }\r\n  });\r\n\r\n  return difference;\r\n}\r\n\r\n/**\r\n * Filter out the keys in an object with a given value.\r\n * @param {object} object - Object to be filtered\r\n * @param {*} [filterValue] - Value to be filtered out; If not specified, then\r\n *   filters out all keys which have an explicit value of \"undefined\"\r\n * @returns {object} - Filtered object\r\n */\r\nfunction filterObject(object, filterValue) {\r\n  return Object.keys(object).reduce(function (filtered, key) {\r\n    if (object[key] !== filterValue) {\r\n      filtered[key] = object[key];\r\n    }\r\n    return filtered;\r\n  }, {});\r\n}\r\n\r\n/**\r\n * Map a list to an array of arrays, and return the flattened result.\r\n * @param {Array<*>|Set<*>|Map<*>} list\r\n * @param {function(*): Array<*>} [mapFn]\r\n * @returns Array<*>\r\n */\r\nfunction flatMap(list, mapFn) {\r\n  var listArray = list instanceof Map || list instanceof Set ? Array.from(list.values()) : list;\r\n\r\n  mapFn = mapFn || function mapFn(item) {\r\n    return item;\r\n  };\r\n\r\n  return listArray.reduce(function (flattened, item) {\r\n    var mapped = mapFn(item);\r\n    return flattened.concat(mapped);\r\n  }, []);\r\n}\r\n\r\n/**\r\n * Get the user agent string, or return \"Unknown\".\r\n * @returns {string}\r\n */\r\nfunction getUserAgent() {\r\n  return typeof navigator !== 'undefined' && navigator.userAgent ? navigator.userAgent : 'Unknown';\r\n}\r\n\r\n/**\r\n * Get the platform component of the user agent string.\r\n * Example:\r\n *   Input - Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.82 Safari/537.36\r\n *   Output - macintosh\r\n * @returns {string}\r\n */\r\nfunction getPlatform() {\r\n  var userAgent = getUserAgent();\r\n\r\n  var _ref = userAgent.match(/\\(([^)]+)\\)/) || [],\r\n      _ref2 = _slicedToArray(_ref, 2),\r\n      _ref2$ = _ref2[1],\r\n      match = _ref2$ === undefined ? 'unknown' : _ref2$;\r\n\r\n  var _match$split$map = match.split(';').map(function (entry) {\r\n    return entry.trim();\r\n  }),\r\n      _match$split$map2 = _slicedToArray(_match$split$map, 1),\r\n      platform = _match$split$map2[0];\r\n\r\n  return platform.toLowerCase();\r\n}\r\n\r\n/**\r\n * Create a unique identifier.\r\n * @returns {string}\r\n */\r\nfunction makeUUID() {\r\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\r\n    var r = Math.random() * 16 | 0;\r\n    var v = c === 'x' ? r : r & 0x3 | 0x8;\r\n    return v.toString(16);\r\n  });\r\n}\r\n\r\n/**\r\n * Ensure that the given function is called once per tick.\r\n * @param {function} fn - Function to be executed\r\n * @returns {function} - Schedules the given function to be called on the next tick\r\n */\r\nfunction oncePerTick(fn) {\r\n  var timeout = null;\r\n\r\n  function nextTick() {\r\n    timeout = null;\r\n    fn();\r\n  }\r\n\r\n  return function scheduleNextTick() {\r\n    if (timeout) {\r\n      clearTimeout(timeout);\r\n    }\r\n    timeout = setTimeout(nextTick);\r\n  };\r\n}\r\n\r\nfunction promiseFromEvents(operation, eventEmitter, successEvent, failureEvent) {\r\n  return new Promise(function (resolve, reject) {\r\n    function onSuccess() {\r\n      var args = [].slice.call(arguments);\r\n      if (failureEvent) {\r\n        eventEmitter.removeListener(failureEvent, onFailure);\r\n      }\r\n      resolve.apply(undefined, _toConsumableArray(args));\r\n    }\r\n    function onFailure() {\r\n      var args = [].slice.call(arguments);\r\n      eventEmitter.removeListener(successEvent, onSuccess);\r\n      reject.apply(undefined, _toConsumableArray(args));\r\n    }\r\n    eventEmitter.once(successEvent, onSuccess);\r\n    if (failureEvent) {\r\n      eventEmitter.once(failureEvent, onFailure);\r\n    }\r\n    operation();\r\n  });\r\n}\r\n\r\n/**\r\n * Traverse down multiple nodes on an object and return null if\r\n * any link in the path is unavailable.\r\n * @param {Object} obj - Object to traverse\r\n * @param {String} path - Path to traverse. Period-separated.\r\n * @returns {Any|null}\r\n */\r\nfunction getOrNull(obj, path) {\r\n  return path.split('.').reduce(function (output, step) {\r\n    if (!output) {\r\n      return null;\r\n    }\r\n    return output[step];\r\n  }, obj);\r\n}\r\n\r\n/**\r\n * @typedef {object} Deferred\r\n * @property {Promise} promise\r\n * @property {function} reject\r\n * @property {function} resolve\r\n */\r\n\r\n/**\r\n * Create a {@link Deferred}.\r\n * @returns {Deferred}\r\n */\r\nfunction defer() {\r\n  var deferred = {};\r\n  deferred.promise = new Promise(function (resolve, reject) {\r\n    deferred.resolve = resolve;\r\n    deferred.reject = reject;\r\n  });\r\n  return deferred;\r\n}\r\n\r\n/**\r\n * Copy a method from a `source` prototype onto a `wrapper` prototype. Invoking\r\n * the method on the `wrapper` prototype will invoke the corresponding method\r\n * on an instance accessed by `target`.\r\n * @param {object} source\r\n * @param {object} wrapper\r\n * @param {string} target\r\n * @param {string} methodName\r\n * @returns {undefined}\r\n */\r\nfunction delegateMethod(source, wrapper, target, methodName) {\r\n  if (methodName in wrapper) {\r\n    // Skip any methods already set.\r\n    return;\r\n  } else if (methodName.match(/^on[a-z]+$/)) {\r\n    // Skip EventHandlers (these are handled in the constructor).\r\n    return;\r\n  }\r\n\r\n  var type = void 0;\r\n  try {\r\n    type = _typeof(source[methodName]);\r\n  } catch (error) {\r\n    // NOTE(mroberts): Attempting to check the type of non-function members\r\n    // on the prototype throws an error for some types.\r\n  }\r\n\r\n  if (type !== 'function') {\r\n    // Skip non-function members.\r\n    return;\r\n  }\r\n\r\n  /* eslint no-loop-func:0 */\r\n  wrapper[methodName] = function () {\r\n    var _target;\r\n\r\n    return (_target = this[target])[methodName].apply(_target, arguments);\r\n  };\r\n}\r\n\r\n/**\r\n * Copy methods from a `source` prototype onto a `wrapper` prototype. Invoking\r\n * the methods on the `wrapper` prototype will invoke the corresponding method\r\n * on an instance accessed by `target`.\r\n * @param {object} source\r\n * @param {object} wrapper\r\n * @param {string} target\r\n * @returns {undefined}\r\n */\r\nfunction delegateMethods(source, wrapper, target) {\r\n  for (var methodName in source) {\r\n    delegateMethod(source, wrapper, target, methodName);\r\n  }\r\n}\r\n\r\n/**\r\n * Determine whether two values are deeply equal.\r\n * @param {*} val1\r\n * @param {*} val2\r\n * @returns {boolean}\r\n */\r\nfunction isDeepEqual(val1, val2) {\r\n  if (val1 === val2) {\r\n    return true;\r\n  }\r\n  if ((typeof val1 === 'undefined' ? 'undefined' : _typeof(val1)) !== (typeof val2 === 'undefined' ? 'undefined' : _typeof(val2))) {\r\n    return false;\r\n  }\r\n  if (val1 === null) {\r\n    return val2 === null;\r\n  }\r\n  if (val2 === null) {\r\n    return false;\r\n  }\r\n  if (Array.isArray(val1)) {\r\n    return Array.isArray(val2) && val1.length === val2.length && val1.every(function (val, i) {\r\n      return isDeepEqual(val, val2[i]);\r\n    });\r\n  }\r\n  if ((typeof val1 === 'undefined' ? 'undefined' : _typeof(val1)) === 'object') {\r\n    var val1Keys = Object.keys(val1).sort();\r\n    var val2Keys = Object.keys(val2).sort();\r\n    return !Array.isArray(val2) && isDeepEqual(val1Keys, val2Keys) && val1Keys.every(function (key) {\r\n      return isDeepEqual(val1[key], val2[key]);\r\n    });\r\n  }\r\n  return false;\r\n}\r\n\r\n/**\r\n * Whether the given argument is a non-array object.\r\n * @param {*} object\r\n * @return {boolean}\r\n */\r\nfunction isNonArrayObject(object) {\r\n  return (typeof object === 'undefined' ? 'undefined' : _typeof(object)) === 'object' && !Array.isArray(object);\r\n}\r\n\r\n/**\r\n * For each property name on the `source` prototype, add getters and/or setters\r\n * to `wrapper` that proxy to `target`.\r\n * @param {object} source\r\n * @param {object} wrapper\r\n * @param {string} target\r\n * @returns {undefined}\r\n */\r\nfunction proxyProperties(source, wrapper, target) {\r\n  Object.getOwnPropertyNames(source).forEach(function (propertyName) {\r\n    proxyProperty(source, wrapper, target, propertyName);\r\n  });\r\n}\r\n\r\n/**\r\n * For the property name on the `source` prototype, add a getter and/or setter\r\n * to `wrapper` that proxies to `target`.\r\n * @param {object} source\r\n * @param {object} wrapper\r\n * @param {string} target\r\n * @param {string} propertyName\r\n * @returns {undefined}\r\n */\r\nfunction proxyProperty(source, wrapper, target, propertyName) {\r\n  if (propertyName in wrapper) {\r\n    // Skip any properties already set.\r\n    return;\r\n  } else if (propertyName.match(/^on[a-z]+$/)) {\r\n    Object.defineProperty(wrapper, propertyName, {\r\n      value: null,\r\n      writable: true\r\n    });\r\n\r\n    target.addEventListener(propertyName.slice(2), function () {\r\n      wrapper.dispatchEvent.apply(wrapper, arguments);\r\n    });\r\n\r\n    return;\r\n  }\r\n\r\n  Object.defineProperty(wrapper, propertyName, {\r\n    enumerable: true,\r\n    get: function get() {\r\n      return target[propertyName];\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * This is a function for turning a Promise into the kind referenced in the\r\n * Legacy Interface Extensions section of the WebRTC spec.\r\n * @param {Promise<*>} promise\r\n * @param {function<*>} onSuccess\r\n * @param {function<Error>} onFailure\r\n * @returns {Promise<undefined>}\r\n */\r\nfunction legacyPromise(promise, onSuccess, onFailure) {\r\n  if (onSuccess) {\r\n    return promise.then(function (result) {\r\n      onSuccess(result);\r\n    }, function (error) {\r\n      onFailure(error);\r\n    });\r\n  }\r\n  return promise;\r\n}\r\n\r\n/**\r\n * Build the {@link LogLevels} object.\r\n * @param {String|LogLevel} logLevel - Log level name or object\r\n * @returns {LogLevels}\r\n */\r\nfunction buildLogLevels(logLevel) {\r\n  if (typeof logLevel === 'string') {\r\n    return {\r\n      default: logLevel,\r\n      media: logLevel,\r\n      signaling: logLevel,\r\n      webrtc: logLevel\r\n    };\r\n  }\r\n  return logLevel;\r\n}\r\n\r\n/**\r\n * Get the {@link Track}'s derived class name\r\n * @param {Track} track\r\n * @param {?boolean} [local=undefined]\r\n * @returns {string}\r\n */\r\nfunction trackClass(track, local) {\r\n  local = local ? 'Local' : '';\r\n  return local + (track.kind || '').replace(/\\w{1}/, function (m) {\r\n    return m.toUpperCase();\r\n  }) + 'Track';\r\n}\r\n\r\n/**\r\n * Get the {@link TrackPublication}'s derived class name\r\n * @param {TrackPublication} publication\r\n * @param {?boolean} [local=undefined]\r\n * @returns {string}\r\n */\r\nfunction trackPublicationClass(publication, local) {\r\n  local = local ? 'Local' : '';\r\n  return local + (publication.kind || '').replace(/\\w{1}/, function (m) {\r\n    return m.toUpperCase();\r\n  }) + 'TrackPublication';\r\n}\r\n\r\n/**\r\n * Sets all underscore-prefixed properties on `object` non-enumerable.\r\n * @param {Object} object\r\n * @returns {void}\r\n */\r\nfunction hidePrivateProperties(object) {\r\n  Object.getOwnPropertyNames(object).forEach(function (name) {\r\n    if (name.startsWith('_')) {\r\n      hideProperty(object, name);\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Creates a new subclass which, in the constructor, sets all underscore-prefixed\r\n * properties and the given public properties non-enumerable. This is useful for\r\n * patching up classes like EventEmitter which may set properties like `_events`\r\n * and `domain`.\r\n * @param {Function} klass\r\n * @param {Array<string>} props\r\n * @returns {Function} subclass\r\n */\r\nfunction hidePrivateAndCertainPublicPropertiesInClass(klass, props) {\r\n  // NOTE(mroberts): We do this to avoid giving the class a name.\r\n  return function (_klass) {\r\n    _inherits(_class, _klass);\r\n\r\n    function _class() {\r\n      var _ref3;\r\n\r\n      _classCallCheck(this, _class);\r\n\r\n      for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\r\n        args[_key] = arguments[_key];\r\n      }\r\n\r\n      var _this = _possibleConstructorReturn(this, (_ref3 = _class.__proto__ || Object.getPrototypeOf(_class)).call.apply(_ref3, [this].concat(args)));\r\n\r\n      hidePrivateProperties(_this);\r\n      hidePublicProperties(_this, props);\r\n      return _this;\r\n    }\r\n\r\n    return _class;\r\n  }(klass);\r\n}\r\n\r\n/**\r\n * Hide a property of an object.\r\n * @param {object} object\r\n * @param {string} name\r\n */\r\nfunction hideProperty(object, name) {\r\n  var descriptor = Object.getOwnPropertyDescriptor(object, name);\r\n  descriptor.enumerable = false;\r\n  Object.defineProperty(object, name, descriptor);\r\n}\r\n\r\n/**\r\n * Hide the given public properties of an object.\r\n * @param {object} object\r\n * @param {Array<string>} [props=[]]\r\n */\r\nfunction hidePublicProperties(object) {\r\n  var props = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\r\n\r\n  props.forEach(function (name) {\r\n    // eslint-disable-next-line no-prototype-builtins\r\n    if (object.hasOwnProperty(name)) {\r\n      hideProperty(object, name);\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Convert an Array of values to an Array of JSON values by calling\r\n * `valueToJSON` on each value.\r\n * @param {Array<*>} array\r\n * @returns {Array<*>}\r\n */\r\nfunction arrayToJSON(array) {\r\n  return array.map(valueToJSON);\r\n}\r\n\r\n/**\r\n * Convert a Set of values to an Array of JSON values by calling `valueToJSON`\r\n * on each value.\r\n * @param {Set<*>} set\r\n * @returns {Array<*>}\r\n */\r\nfunction setToJSON(set) {\r\n  return arrayToJSON([].concat(_toConsumableArray(set)));\r\n}\r\n\r\n/**\r\n * Convert a Map from strings to values to an object of JSON values by calling\r\n * `valueToJSON` on each value.\r\n * @param {Map<string, *>} map\r\n * @returns {object}\r\n */\r\nfunction mapToJSON(map) {\r\n  return [].concat(_toConsumableArray(map.entries())).reduce(function (json, _ref4) {\r\n    var _ref5 = _slicedToArray(_ref4, 2),\r\n        key = _ref5[0],\r\n        value = _ref5[1];\r\n\r\n    return Object.assign(_defineProperty({}, key, valueToJSON(value)), json);\r\n  }, {});\r\n}\r\n\r\n/**\r\n * Convert an object to a JSON value by calling `valueToJSON` on its enumerable\r\n * keys.\r\n * @param {object} object\r\n * @returns {object}\r\n */\r\nfunction objectToJSON(object) {\r\n  return Object.entries(object).reduce(function (json, _ref6) {\r\n    var _ref7 = _slicedToArray(_ref6, 2),\r\n        key = _ref7[0],\r\n        value = _ref7[1];\r\n\r\n    return Object.assign(_defineProperty({}, key, valueToJSON(value)), json);\r\n  }, {});\r\n}\r\n\r\n/**\r\n * Convert a value into a JSON value.\r\n * @param {*} value\r\n * @returns {*}\r\n */\r\nfunction valueToJSON(value) {\r\n  if (Array.isArray(value)) {\r\n    return arrayToJSON(value);\r\n  } else if (value instanceof Set) {\r\n    return setToJSON(value);\r\n  } else if (value instanceof Map) {\r\n    return mapToJSON(value);\r\n  } else if (value && (typeof value === 'undefined' ? 'undefined' : _typeof(value)) === 'object') {\r\n    return objectToJSON(value);\r\n  }\r\n  return value;\r\n}\r\n\r\nfunction createRoomConnectEventPayload(connectOptions) {\r\n  function boolToString(val) {\r\n    return val ? 'true' : 'false';\r\n  }\r\n  var payload = {\r\n    // arrays props converted to lengths.\r\n    iceServers: (connectOptions.iceServers || []).length,\r\n    audioTracks: (connectOptions.tracks || []).filter(function (track) {\r\n      return track.kind === 'audio';\r\n    }).length,\r\n    videoTracks: (connectOptions.tracks || []).filter(function (track) {\r\n      return track.kind === 'video';\r\n    }).length,\r\n    dataTracks: (connectOptions.tracks || []).filter(function (track) {\r\n      return track.kind === 'data';\r\n    }).length\r\n  };\r\n\r\n  // boolean properties.\r\n  [['audio'], ['automaticSubscription'], ['enableDscp'], ['eventListener'], ['preflight'], ['video'], ['dominantSpeaker', 'enableDominantSpeaker']].forEach(function (_ref8) {\r\n    var _ref9 = _slicedToArray(_ref8, 2),\r\n        prop = _ref9[0],\r\n        eventProp = _ref9[1];\r\n\r\n    eventProp = eventProp || prop;\r\n    payload[eventProp] = boolToString(!!connectOptions[prop]);\r\n  });\r\n\r\n  // numbers and string properties.\r\n  [['maxVideoBitrate'], ['maxAudioBitrate'], ['iceTransportPolicy'], ['region'], ['name', 'roomName']].forEach(function (_ref10) {\r\n    var _ref11 = _slicedToArray(_ref10, 2),\r\n        prop = _ref11[0],\r\n        eventProp = _ref11[1];\r\n\r\n    eventProp = eventProp || prop;\r\n    if (typeof connectOptions[prop] === 'number' || typeof connectOptions[prop] === 'string') {\r\n      payload[eventProp] = connectOptions[prop];\r\n    }\r\n  });\r\n\r\n  // array props stringified.\r\n  ['preferredAudioCodecs', 'preferredVideoCodecs'].forEach(function (prop) {\r\n    if (prop in connectOptions) {\r\n      payload[prop] = JSON.stringify(connectOptions[prop]);\r\n    }\r\n  });\r\n\r\n  if ('networkQuality' in connectOptions) {\r\n    payload.networkQualityConfiguration = {};\r\n    if (isNonArrayObject(connectOptions.networkQuality)) {\r\n      ['local', 'remote'].forEach(function (prop) {\r\n        if (typeof connectOptions.networkQuality[prop] === 'number') {\r\n          payload.networkQualityConfiguration[prop] = connectOptions.networkQuality[prop];\r\n        }\r\n      });\r\n    } else {\r\n      payload.networkQualityConfiguration.remote = 0;\r\n      payload.networkQualityConfiguration.local = connectOptions.networkQuality ? 1 : 0;\r\n    }\r\n  }\r\n\r\n  if (connectOptions.bandwidthProfile && connectOptions.bandwidthProfile.video) {\r\n    var videoBPOptions = connectOptions.bandwidthProfile.video || {};\r\n    payload.bandwidthProfileOptions = {};\r\n    ['mode', 'maxTracks', 'trackSwitchOffMode', 'dominantSpeakerPriority', 'maxSubscriptionBitrate'].forEach(function (prop) {\r\n      if (typeof videoBPOptions[prop] === 'number' || typeof videoBPOptions[prop] === 'string') {\r\n        if (prop in videoBPOptions) {\r\n          payload.bandwidthProfileOptions[prop] = videoBPOptions[prop];\r\n        }\r\n      }\r\n    });\r\n\r\n    if ('renderDimensions' in videoBPOptions) {\r\n      payload.bandwidthProfileOptions.renderDimensions = JSON.stringify(videoBPOptions.renderDimensions);\r\n    }\r\n  }\r\n\r\n  return {\r\n    group: 'room',\r\n    name: 'connect',\r\n    level: 'info',\r\n    payload: payload\r\n  };\r\n}\r\n\r\n/**\r\n * Create the bandwidth profile payload included in an RSP connect message.\r\n * @param {BandwidthProfileOptions} bandwidthProfile\r\n * @returns {object}\r\n */\r\nfunction createBandwidthProfilePayload(bandwidthProfile) {\r\n  return createRSPPayload(bandwidthProfile, [{ prop: 'video', type: 'object', transform: createBandwidthProfileVideoPayload }]);\r\n}\r\n\r\n/**\r\n * Create the bandwidth profile video payload included in an RSP connect message.\r\n * @param {VideoBandwidthProfileOptions} bandwidthProfileVideo\r\n * @returns {object}\r\n */\r\nfunction createBandwidthProfileVideoPayload(bandwidthProfileVideo) {\r\n  return createRSPPayload(bandwidthProfileVideo, [{ prop: 'dominantSpeakerPriority', type: 'string', payloadProp: 'active_speaker_priority' }, { prop: 'maxSubscriptionBitrate', type: 'number', payloadProp: 'max_subscription_bandwidth' }, { prop: 'maxTracks', type: 'number', payloadProp: 'max_tracks' }, { prop: 'mode', type: 'string' }, { prop: 'renderDimensions', type: 'object', payloadProp: 'render_dimensions', transform: createRenderDimensionsPayload }, { prop: 'trackSwitchOffMode', type: 'string', payloadProp: 'track_switch_off' }]);\r\n}\r\n\r\n/**\r\n * Create the Media Signaling payload included in an RSP connect message.\r\n * @param {boolean} dominantSpeaker - whether to enable the Dominant Speaker\r\n *   protocol or not\r\n * @param {boolean} networkQuality - whether to enable the Network Quality\r\n *   protocol or not\r\n * @param {boolean} trackPriority - whether to enable the Track Priority\r\n *   protocol or not\r\n * @param {boolean} trackSwitchOff - whether to enable the Track Switch-Off\r\n *   protocol or not.\r\n * @returns {object}\r\n */\r\nfunction createMediaSignalingPayload(dominantSpeaker, networkQuality, trackPriority, trackSwitchOff) {\r\n  var transports = { transports: [{ type: 'data-channel' }] };\r\n  return Object.assign(dominantSpeaker\r\n  // eslint-disable-next-line\r\n  ? { active_speaker: transports } : {}, networkQuality\r\n  // eslint-disable-next-line\r\n  ? { network_quality: transports } : {}, trackPriority\r\n  // eslint-disable-next-line\r\n  ? { track_priority: transports } : {}, trackSwitchOff\r\n  // eslint-disable-next-line\r\n  ? { track_switch_off: transports } : {});\r\n}\r\n\r\n/**\r\n * Create {@link VideoTrack.Dimensions} RSP payload.\r\n * @param {VideoTrack.Dimensions} [dimensions]\r\n * @returns {object}\r\n */\r\nfunction createDimensionsPayload(dimensions) {\r\n  return createRSPPayload(dimensions, [{ prop: 'height', type: 'number' }, { prop: 'width', type: 'number' }]);\r\n}\r\n\r\n/**\r\n * Create {@link VideoRenderDimensions} RSP payload.\r\n * @param renderDimensions\r\n * @returns {object}\r\n */\r\nfunction createRenderDimensionsPayload(renderDimensions) {\r\n  var PRIORITY_HIGH = trackPriority.PRIORITY_HIGH,\r\n      PRIORITY_LOW = trackPriority.PRIORITY_LOW,\r\n      PRIORITY_STANDARD = trackPriority.PRIORITY_STANDARD;\r\n\r\n  return createRSPPayload(renderDimensions, [{ prop: PRIORITY_HIGH, type: 'object', transform: createDimensionsPayload }, { prop: PRIORITY_LOW, type: 'object', transform: createDimensionsPayload }, { prop: PRIORITY_STANDARD, type: 'object', transform: createDimensionsPayload }]);\r\n}\r\n\r\n/**\r\n * Create an RSP payload for the given object.\r\n * @param {object} object - object for which RSP payload is to be generated\r\n * @param {Array<object>} propConversions - conversion rules for object properties;\r\n *   they specify how object properties should be converted to their corresponding\r\n *   RSP payload properties\r\n * @returns {object}\r\n */\r\nfunction createRSPPayload(object, propConversions) {\r\n  return propConversions.reduce(function (payload, _ref12) {\r\n    var prop = _ref12.prop,\r\n        type = _ref12.type,\r\n        _ref12$payloadProp = _ref12.payloadProp,\r\n        payloadProp = _ref12$payloadProp === undefined ? prop : _ref12$payloadProp,\r\n        _ref12$transform = _ref12.transform,\r\n        transform = _ref12$transform === undefined ? function (x) {\r\n      return x;\r\n    } : _ref12$transform;\r\n\r\n    return _typeof(object[prop]) === type ? Object.assign(_defineProperty({}, payloadProp, transform(object[prop])), payload) : payload;\r\n  }, {});\r\n}\r\n\r\n/**\r\n * Create the subscribe payload included in an RSP connect/update message.\r\n * @param {boolean} automaticSubscription - whether to subscribe to all RemoteTracks\r\n * @returns {object}\r\n */\r\nfunction createSubscribePayload(automaticSubscription) {\r\n  return {\r\n    rules: [{\r\n      type: automaticSubscription ? 'include' : 'exclude',\r\n      all: true\r\n    }],\r\n    revision: 1\r\n  };\r\n}\r\n\r\n/**\r\n * Add random jitter to a given value in the range [-jitter, jitter].\r\n * @private\r\n * @param {number} value\r\n * @param {number} jitter\r\n * @returns {number} value + random(-jitter, +jitter)\r\n */\r\nfunction withJitter(value, jitter) {\r\n  var rand = Math.random();\r\n  return value - jitter + Math.floor(2 * jitter * rand + 0.5);\r\n}\r\n\r\n/**\r\n * Checks if the a number is in the range [min, max].\r\n * @private\r\n * @param {num} num\r\n * @param {number} min\r\n * @param {number} max\r\n * @return {boolean}\r\n */\r\nfunction inRange(num, min, max) {\r\n  return min <= num && num <= max;\r\n}\r\n\r\n/**\r\n * returns true if given MediaStreamTrack is a screen share track\r\n * @private\r\n * @param {MediaStreamTrack} track\r\n * @returns {boolean}\r\n */\r\nfunction isChromeScreenShareTrack(track) {\r\n  // NOTE(mpatwardhan): Chrome creates screen share tracks with label like: \"screen:69734272*\"\r\n  // we will check for label that starts with \"screen:D\" where D being a digit.\r\n  var isChrome = util.guessBrowser() === 'chrome';\r\n  return isChrome && track.kind === 'video' && track.label && (/^screen:[0-9]+/.test(track.label) || /^web-contents-media-stream:[0-9/]+/.test(track.label) || /^window:[0-9]+/.test(track.label));\r\n}\r\n\r\n/**\r\n * Returns a promise that resolve after timeoutMS have passed.\r\n * @param {number} timeoutMS - time to wait in milliseconds.\r\n * @returns {Promise<void>}\r\n */\r\nfunction waitForSometime() {\r\n  var timeoutMS = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 10;\r\n\r\n  return new Promise(function (resolve) {\r\n    return setTimeout(resolve, timeoutMS);\r\n  });\r\n}\r\n\r\n/**\r\n * Returns a promise that resolve after event is received\r\n * @returns {Promise<void>}\r\n */\r\nfunction waitForEvent(eventTarget, event) {\r\n  return new Promise(function (resolve) {\r\n    eventTarget.addEventListener(event, function onevent(e) {\r\n      eventTarget.removeEventListener(event, onevent);\r\n      resolve(e);\r\n    });\r\n  });\r\n}\r\n\r\nexports.constants = constants;\r\nexports.createBandwidthProfilePayload = createBandwidthProfilePayload;\r\nexports.createMediaSignalingPayload = createMediaSignalingPayload;\r\nexports.createRoomConnectEventPayload = createRoomConnectEventPayload;\r\nexports.createSubscribePayload = createSubscribePayload;\r\nexports.asLocalTrack = asLocalTrack;\r\nexports.asLocalTrackPublication = asLocalTrackPublication;\r\nexports.capitalize = capitalize;\r\nexports.deprecateEvents = deprecateEvents;\r\nexports.difference = difference;\r\nexports.filterObject = filterObject;\r\nexports.flatMap = flatMap;\r\nexports.getPlatform = getPlatform;\r\nexports.getUserAgent = getUserAgent;\r\nexports.hidePrivateProperties = hidePrivateProperties;\r\nexports.hidePrivateAndCertainPublicPropertiesInClass = hidePrivateAndCertainPublicPropertiesInClass;\r\nexports.isDeepEqual = isDeepEqual;\r\nexports.isNonArrayObject = isNonArrayObject;\r\nexports.inRange = inRange;\r\nexports.makeUUID = makeUUID;\r\nexports.oncePerTick = oncePerTick;\r\nexports.promiseFromEvents = promiseFromEvents;\r\nexports.getOrNull = getOrNull;\r\nexports.defer = defer;\r\nexports.delegateMethods = delegateMethods;\r\nexports.proxyProperties = proxyProperties;\r\nexports.legacyPromise = legacyPromise;\r\nexports.buildLogLevels = buildLogLevels;\r\nexports.trackClass = trackClass;\r\nexports.trackPublicationClass = trackPublicationClass;\r\nexports.valueToJSON = valueToJSON;\r\nexports.withJitter = withJitter;\r\nexports.isChromeScreenShareTrack = isChromeScreenShareTrack;\r\nexports.waitForSometime = waitForSometime;\r\nexports.waitForEvent = waitForEvent;"]},"metadata":{},"sourceType":"script"}